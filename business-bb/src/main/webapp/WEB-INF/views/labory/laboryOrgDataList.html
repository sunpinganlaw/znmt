<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
    <title>化验数据查询和确认</title>
    <base href="${base}/">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
    <meta http-equiv="description" content="this is my page">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">

    <#include "/include/common.html"/>

</head>

<body>
<div id="scalesEditWin" ></div>
<div id="confirmWin" ></div>
<input type="hidden" id="comboboxInputVal"/>
<div class="easyui-tabs" style="width:100%;height:510px">

    <div title="全水" style="padding:10px">
        <div>
            <label for="laLaborCode">化验编码：</label>
            <input id="laLaborCode" style="width:120px;"/>
            <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search"  onclick="match('laLaborCode');"></a>

            <label for="laBeginDate">化验日期：</label>
            <input class="easyui-datebox" id="laBeginDate" style="width:120px">&nbsp;—&nbsp;
            <input class="easyui-datebox" id="laEndDate"  style="width:120px">

            <!--<label for="laBatchType">化验批次类型：</label>-->
            <!--<input id="laBatchType" style="width:120px;"/>-->
            <label for="laStatus">确认状态：</label>
            <input id="laStatus" style="width:120px;"/>
            <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search"  onclick="qryLaData();">查询</a>
            <@shiro.hasPermission name="LabOrgDataMgr:control1">
            <a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-ok" onclick="confirmMt();">确认提交</a>
            </@shiro.hasPermission>
        </div>

        <!--<div style="margin: 5px;width: 100%">-->
            <!--<span style="color: #0099FF"><strong>水分分析仪</strong></span>-->
            <!--<table id="labLaDataDg" ></table>-->
        <!--</div>-->

        <div style="margin: 5px;width: 100%">
            <span style="color: #0099FF"><strong>天平</strong></span>
            <table id="labScaleMTDataDg" ></table>
        </div>
    </div>


    <div title="水分" style="padding:10px">
        <div>
            <label for="iLaborCode">化验编码：</label>
            <input id="iLaborCode" style="width:120px;"/>
            <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search"  onclick="match('iLaborCode');"></a>

            <label for="iBeginDate">化验日期：</label>
            <input class="easyui-datebox" id="iBeginDate" style="width:120px">&nbsp;—&nbsp;
            <input class="easyui-datebox" id="iEndDate"  style="width:120px">

            <!--<label for="iBatchType">化验批次类型：</label>-->
            <!--<input id="iBatchType" style="width:120px;"/>-->
            <label for="iStatus">确认状态：</label>
            <input id="iStatus" style="width:120px;"/>
            <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search"  onclick="qryIData();">查询</a>

            <@shiro.hasPermission name="LabOrgDataMgr:control1">
            <a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-ok" onclick="confirmMad();">确认提交</a>
            </@shiro.hasPermission>
        </div>

        <div style="margin: 5px;width: 100%">
            <span style="color: #0099FF"><strong>工业分析仪</strong></span>
            <table id="labIDataDg" ></table>
        </div>

        <div style="margin: 5px;width: 100%">
            <span style="color: #0099FF"><strong>天平</strong></span>
            <table id="labScaleMADDataDg" ></table>
        </div>
    </div>


    <div title="灰分" style="padding:10px">
        <div>
            <label for="aLaborCode">化验编码：</label>
            <input id="aLaborCode" style="width:120px;"/>
            <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search"  onclick="match('aLaborCode');"></a>

            <label for="aBeginDate">化验日期：</label>
            <input class="easyui-datebox" id="aBeginDate" style="width:120px">&nbsp;—&nbsp;
            <input class="easyui-datebox" id="aEndDate"  style="width:120px">

            <!--<label for="aBatchType">化验批次类型：</label>-->
            <!--<input id="aBatchType" style="width:120px;"/>-->
            <label for="aStatus">确认状态：</label>
            <input id="aStatus" style="width:120px;"/>
            <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search"  onclick="qryAData();">查询</a>

            <@shiro.hasPermission name="LabOrgDataMgr:control1">
            <a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-ok" onclick="confirmAad();">确认提交</a>
            </@shiro.hasPermission>
        </div>

        <div style="margin: 5px;width: 100%">
            <span style="color: #0099FF"><strong>工业分析仪</strong></span>
            <table id="labADataDg" ></table>
        </div>

        <div style="margin: 5px;width: 100%">
            <span style="color: #0099FF"><strong>天平</strong></span>
            <table id="labScaleAADDataDg" ></table>
        </div>
    </div>


    <div title="挥发分" style="padding:10px">
        <div>
            <label for="vLaborCode">化验编码：</label>
            <input id="vLaborCode" style="width:120px;"/>
            <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search"  onclick="match('vLaborCode');"></a>

            <label for="vBeginDate">化验日期：</label>
            <input class="easyui-datebox" id="vBeginDate" style="width:120px">&nbsp;—&nbsp;
            <input class="easyui-datebox" id="vEndDate"  style="width:120px">

            <!--<label for="vBatchType">化验批次类型：</label>-->
            <!--<input id="vBatchType" style="width:120px;"/>-->
            <label for="vStatus">确认状态：</label>
            <input id="vStatus" style="width:120px;"/>
            <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search"  onclick="qryVData();">查询</a>

            <@shiro.hasPermission name="LabOrgDataMgr:control1">
            <a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-ok" onclick="confirmVad();">确认提交</a>
            </@shiro.hasPermission>
        </div>

        <div style="margin: 5px;width: 100%">
            <span style="color: #0099FF"><strong>工业分析仪</strong></span>
            <table id="labVDataDg" ></table>
        </div>

        <div style="margin: 5px;width: 100%">
            <span style="color: #0099FF"><strong>天平</strong></span>
            <a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-edit" onclick="calVad();">计算挥发分</a>
            <span style="color: #0099FF">因挥发分计算需水分参与，故需在天平称量的水分（Mad）被确认后进行计算</span>
            <table id="labScaleVADDataDg" ></table>
        </div>
    </div>


    <div title="硫分" style="padding:10px">
        <div id="tbs">
            <label for="sLaborCode">化验编码：</label>
            <input id="sLaborCode" style="width:120px;"/>
            <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search"  onclick="match('sLaborCode');"></a>

            <label for="sBeginDate">化验日期：</label>
            <input class="easyui-datebox" id="sBeginDate" style="width:120px">&nbsp;—&nbsp;
            <input class="easyui-datebox" id="sEndDate"  style="width:120px">

            <!--<label for="sBatchType">化验批次类型：</label>-->
            <!--<input id="sBatchType" style="width:120px;"/>-->
            <label for="sStatus">确认状态：</label>
            <input id="sStatus" style="width:120px;"/>
            <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search"  onclick="qrySData();">查询</a>
            <@shiro.hasPermission name="LabOrgDataMgr:control1">
            <!--<a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-cancel" onclick="deleteSRows()">确认无效</a>-->
            <a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-ok" onclick="addLotSRows();">确认提交</a>
            </@shiro.hasPermission>
        </div>

        <table id="labSDataDg" ></table>
    </div>


    <div title="热值" style="padding:10px">
        <div id="tbhot">
            <label for="hLaborCode">化验编码：</label>
            <input id="hLaborCode" style="width:120px;"/>
            <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search"  onclick="match('hLaborCode');"></a>

            <label for="hBeginDate">化验日期：</label>
            <input class="easyui-datebox" id="hBeginDate" style="width:120px">&nbsp;—&nbsp;
            <input class="easyui-datebox" id="hEndDate"  style="width:120px">

            <!--<label for="hBatchType">化验批次类型：</label>-->
            <!--<input id="hBatchType" style="width:120px;"/>-->
            <label for="hStatus">确认状态：</label>
            <input id="hStatus" style="width:120px;"/>
            <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search"  onclick="qryHotData();">查询</a>

            <@shiro.hasPermission name="LabOrgDataMgr:control1">
            <!--<a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-cancel" onclick="deleteHotRows()">确认无效</a>-->
            <a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-ok" onclick="addLotHotRows();">确认提交</a>
            </@shiro.hasPermission>
        </div>

        <table id="labHotDataDg" ></table>
    </div>


    <!--<div title="氢元素" style="padding:10px">-->
        <!--<div id="tbhw">-->
            <!--<label for="hwLaborCode">化验编码：</label>-->
            <!--<input id="hwLaborCode" style="width:120px;"/>-->
            <!--<label for="hwBeginDate">化验日期：</label>-->
            <!--<input class="easyui-datebox" id="hwBeginDate" style="width:120px">&nbsp;—&nbsp;-->
            <!--<input class="easyui-datebox" id="hwEndDate"  style="width:120px">-->

            <!--<label for="hwBatchType">化验批次类型：</label>-->
            <!--<input id="hwBatchType" style="width:120px;"/>-->
            <!--<label for="hwStatus">确认状态：</label>-->
            <!--<input id="hwStatus" style="width:120px;"/>-->
            <!--<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search"  onclick="qryhwData();">查询</a>-->
            <!--&lt;!&ndash;<a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-cancel" onclick="deletehwRows()">确认无效</a>&ndash;&gt;-->
            <!--<a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-ok" onclick="addLothwRows();">确认提交</a>-->
        <!--</div>-->
        <!--<table id="labHwDataDg" ></table>-->
    <!--</div>-->

    <div title="元素分析和灰熔融性" style="padding:10px">
        <div id="hadSt">
            <label for="inputLaborCode">化验编码：</label>
            <input id="inputLaborCode" style="width:120px;"/>
            <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search"  onclick="match('inputLaborCode');"></a>

            <label for="had">氢值：</label>
            <input class="easyui-numberbox" id="had" name="had" style="width:145px" data-options="min:0,precision:2">
            <label for="st">软化温度：</label>
            <input class="easyui-numberbox" id="st" name="st" style="width:145px" data-options="min:0,precision:0">
            <a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-ok" onclick="submitInput();">提交</a>
        </div>
        <br/>
        <br/>
        <div>
            <span style="color: #0099FF">&nbsp;&nbsp;&nbsp;&nbsp;1. 如果未输入氢值，则系统默认自动使用公式计算氢值</span>
        </div>
        <br/>
        <div>
            <span style="color: #0099FF">&nbsp;&nbsp;&nbsp;&nbsp;2. 如果未输入灰熔融性软化温度，则系统默认为0</span>
        </div>
        <!--<table id="labMeltDataDg" ></table>-->
    </div>

</div>

</body>
</html>

<script type="text/javascript">
    //公共部分信息
    var selectedScaless;//天平选择行
    var selectedS;//硫分选择行
    var selectedI;//工业分析选择行
    var selectedA;//灰分
    var selectedV;//挥发分
    var selectedHot;//量热仪选择行
    var selectedLa;//光分仪选择行
    var selectedHw;//测氢仪选择行
    var selectedMelt;//灰熔融测量仪选择行
    var dataType;
    var thisDate = new Date();
    var beginDate = thisDate.getFullYear()+"-"+(parseInt(thisDate.getMonth())+1)+"-"+thisDate.getDate();
    var endDate =  thisDate.getFullYear()+"-"+(parseInt(thisDate.getMonth())+1)+"-"+thisDate.getDate();

    //计算日期差
    function diffDate(date1, date2){
        Date.prototype.diff = function(date){
            return (this.getTime() - date.getTime())/(24 * 60 * 60 * 1000);
        }
        // 构造两个日期，分别是系统时间和2013/04/08 12:43:45
        var beginDate = new Date(date1);
        var endDate = new Date(date2);
        // 调用日期差方法，求得参数日期与系统时间相差的天数
        var diff = endDate.diff(beginDate);
        return diff;
    }

    function match(laborCodeName){
        var inputVal = document.getElementById("comboboxInputVal").value;
        $("#"+laborCodeName).combobox("reload",  '${base}/business/tool/getComboboxOpt/LABOR_CODE/'+inputVal);
    }

    //////////////////////////////////////////////////全水 begin/////////////////////////////////////////////////////////////
//    $laDg = $("#labLaDataDg");
    $labScaleMTDataDg = $("#labScaleMTDataDg");

    $(function () {
        $('#laStatus').combobox({
            panelHeight:'auto',
            valueField:'id',
            textField:'name',
            data: [
                {id: '', name: '全部'},
                {id: '0', name: '未确认', selected: true},
                {id: '1',name: '已确认'}
            ]
        });


//        $('#laBatchType').combobox({
//            panelHeight:'auto',
//            valueField:'id',
//            textField:'name',
//            data: [
//                {id: '', name: '全部', selected: true},
//                {id: '1', name: '第1次化验'},
//                {id: '2', name: '第2次化验'},
//                {id: '3',name: '第3次化验'},
//                {id: '4',name: '第4次化验'}
//            ]
//        });
    });

    //下拉框获取化验编码
    $('#laLaborCode').combobox({
        url: '${base}/business/tool/getComboboxOpt/LABOR_CODE',
        panelHeight:'auto',
        valueField:'id',
        textField:'name',
        onChange: function (n, o) {
            if (n != undefined) {
                document.getElementById("comboboxInputVal").value = n;
            }
        }
    });

//    $(function () {
//        $laDg.datagrid({
//            url: "${base}/business/labory/qryLaResOrgData",
//            fitColumns: true,//此处一定不要自适应
//            height: 190,
//            width: $(this).width() - 25,
//            idField:'id',
//            queryParams: {
//                search_laborCode:'-1'//默认不查
//            },
//    rowStyler: function(index,row){
//        if (row.ccStatus == '1'){
//            return 'background-color:red;font-weight:bold;';
//        }
//    },
//            columns: [
//                [
//                    {field: 'id', title: 'ID', width: 10, align:'center',checkbox:true},
//                    {field: 'laborCode', title: '化验编码',align:'center', width:100},
//                    {field: 'batchType', title: '化验批次类型',align:'center', width: 70},
//                    {field: 'opTime', title: '化验时间',align:'center', width: 130},
//                    {field: 'opName', title: '化验人',align:'center', width: 70},
//                    {field: 'deviceName', title: '化验设备',align:'center', width: 70},
//                    {field: 'mt', title: '全水分',align:'center', width: 70},
//                    {field: 'statusName', title: '确认状态',align:'center', width: 70}
//                ]
//            ]
//        })
//    });


    $(function () {
        $labScaleMTDataDg.datagrid({
            url: "${base}/business/labory/qryScalesResOrgDataNew",
            fitColumns: true,//此处一定不要自适应
            height: 400,
            width: $(this).width() - 25,
            idField:'id',
            queryParams: {
                search_laborCode:'-1'//默认不查
            },
            rowStyler: function(index,row){
                if (row.ccStatus == '1'){
                    return 'background-color:red;font-weight:bold;';
                }
            },
            columns: [
                [   {field: 'id', title: 'ID', width: 10, align:'center',checkbox:true},
                    {field: 'laborCode', title: '化验编码',align:'center', width:100},
//                    {field: 'batchType', title: '化验批次类型',align:'center', width: 70},
                    {field: 'opTime', title: '化验时间',align:'center', width: 110},
                    {field: 'opName', title: '化验人',align:'center', width: 70},
                    {field: 'deviceName', title: '化验设备',align:'center', width: 70},
                    {field: 'ggNo', title: '坩埚号',align:'center', width: 70,hidden:true},
                    {field: 'mypQty', title: '坩埚重量',align:'center', width: 70},
                    {field: 'totalQty', title: '坩埚样品重量(化验前)',align:'center', width: 90},
                    {field: 'afterDryQty', title: '坩埚样品重量(化验后)',align:'center', width: 90},
                    {field: 'indexVal', title: '全水分(Mt)',align:'center', width: 70},
                    {field: 'statusName', title: '确认状态',align:'center', width: 70}
                ]
            ]
        })
    });


    function qryLaData() {
        var qryBeginDate = $("#laBeginDate").datebox("getValue");
        var qryEndDate =  $("#laEndDate").datebox("getValue");
        var qryStatus = $("#laStatus").combobox("getValue");
//        var qryBatchType = $("#laBatchType").combobox("getValue");
        var qryLaborCode = $("#laLaborCode").textbox("getValue");

        if (qryLaborCode == null || qryLaborCode ==""){
            if ((qryBeginDate ==null || qryBeginDate =="" || qryBeginDate.length==0)
                    ||(qryEndDate ==null || qryEndDate =="" || qryEndDate.length==0)){
                showMsg("提示", "请选择化验编码或化验日期（选化验编码会加快查询速度）!");
                return false;
            } else {
                if (diffDate(qryBeginDate, qryEndDate) > 10){
                    showMsg("提示", "查询日期跨度不能超过10天!");
                    return false;
                }
            }
        }

        var paramObj = new Object();

        if (qryBeginDate != undefined && qryBeginDate != null && qryBeginDate != "") {
            paramObj.search_beginDate = qryBeginDate;
        }

        if (qryEndDate != undefined && qryEndDate != null && qryEndDate != "") {
            paramObj.search_endDate = qryEndDate;
        }

        if (qryStatus != null && qryStatus != undefined && qryStatus != "") {
            paramObj.search_status = qryStatus;
        }

//        if (qryBatchType != null && qryBatchType != undefined && qryBatchType != "") {
//            paramObj.search_batchType = qryBatchType;
//        }

        if (qryLaborCode != null && qryLaborCode != undefined && qryLaborCode != "") {
            paramObj.search_laborCode = qryLaborCode;
        }
        paramObj.search_indexType = 'mt';

//        $laDg.datagrid("load",paramObj);
        $labScaleMTDataDg.datagrid("load",paramObj);
    }


    function confirmMt() {
        selectedLa = null;
        selectedScaless = null;
        dataType = null;
//        var rows =  $laDg.datagrid('getSelections');
        var rows1 =  $labScaleMTDataDg.datagrid('getSelections');

        if (rows1.length == 0) {
            showMsg("提示", "请选择确认的化验记录");
            return false;
        }else {
            if (rows1.length < 2){
                showMsg("提示", "请至少选择2条全水化验数据！");
                return false;
            }
//            selectedLa = rows;
            selectedScaless = rows1;
            dataType = 'mt';
        }

//        for ( var i = 0; !(i >= rows.length); i++) {
//            if (rows[i].status != "0"){
//                showMsg("提示", "“已确认”状态的化验数据不能再提交确认！");
//                return false;
//            }
//        }

        for ( var i = 0; !(i >= rows1.length); i++) {
            if (rows1[i].status != "0"){
                showMsg("提示", "“已确认”状态的化验数据不能再提交确认！");
                return false;
            }
        }

        $('#confirmWin').window({
            modal : true,
            title : '数据录入并提交',
            width : 450,
            height : 200,
            collapsible : false,
            minimizable : false,
            maximizable : true,
            href : '${base}/business/labory/loteditLabData',
            onClose : function() {
//                $laDg.datagrid('reload');
                $labScaleMTDataDg.datagrid('reload');
            }
        });
    }
    //////////////////////////////////////////////////全水 end/////////////////////////////////////////////////////////////

    //////////////////////////////////////////////////水分 begin/////////////////////////////////////////////////////////////
    $iDg = $("#labIDataDg");
    $labScaleMADDataDg = $("#labScaleMADDataDg");

    $(function () {
        $('#iStatus').combobox({
            panelHeight:'auto',
            valueField:'id',
            textField:'name',
            data: [
                {id: '', name: '全部'},
                {id: '0', name: '未确认', selected: true},
                {id: '1',name: '已确认'}
            ]
        });

//        $('#iBatchType').combobox({
//            panelHeight:'auto',
//            valueField:'id',
//            textField:'name',
//            data: [
//                {id: '', name: '全部', selected: true},
//                {id: '1', name: '第1次化验'},
//                {id: '2', name: '第2次化验'},
//                {id: '3',name: '第3次化验'},
//                {id: '4',name: '第4次化验'}
//            ]
//        });
    });

    //下拉框获取化验编码
    $('#iLaborCode').combobox({
        url: '${base}/business/tool/getComboboxOpt/LABOR_CODE',
        panelHeight:'auto',
        valueField:'id',
        textField:'name',
        onChange: function (n, o) {
            if (n != undefined) {
                document.getElementById("comboboxInputVal").value = n;
            }
        }
    });

    $(function () {
        $iDg.datagrid({
            url: "${base}/business/labory/qryIAResOrgData",
            fitColumns: true,
            height: 190,
            width: $(this).width() - 25,
            idField:'id',
            queryParams: {
                search_laborCode:'-1'//默认不查
            },
            rowStyler: function(index,row){
                if (row.ccStatus == '1'){
                    return 'background-color:red;font-weight:bold;';
                }
            },
            columns: [
                [
                    {field: 'id', title: 'ID', width: 10, align:'center',checkbox:true},
                    {field: 'laborCode', title: '化验编码',align:'center', width:100},
//                    {field: 'batchType', title: '化验批次类型',align:'center', width: 70},
                    {field: 'opTime', title: '化验时间',align:'center', width: 130},
                    {field: 'opName', title: '化验人',align:'center', width: 70},
                    {field: 'deviceName', title: '化验设备',align:'center', width: 70},
                    {field: 'mad', title: '水分(Mad)',align:'center', width: 70},
                    {field: 'statusName', title: '确认状态',align:'center', width: 70}
                ]
            ]
        })
    });


    $(function () {
        $labScaleMADDataDg.datagrid({
            url: "${base}/business/labory/qryScalesResOrgDataNew",
            fitColumns: true,
            height: 190,
            width: $(this).width() - 25,
            idField:'id',
            queryParams: {
                search_laborCode:'-1'//默认不查
            },
            rowStyler: function(index,row){
                if (row.ccStatus == '1'){
                    return 'background-color:red;font-weight:bold;';
                }
            },
            columns: [
                [   {field: 'id', title: 'ID', width: 10, align:'center',checkbox:true},
                    {field: 'laborCode', title: '化验编码',align:'center', width:100},
//                    {field: 'batchType', title: '化验批次类型',align:'center', width: 70},
                    {field: 'opTime', title: '化验时间',align:'center', width: 110},
                    {field: 'opName', title: '化验人',align:'center', width: 70},
                    {field: 'deviceName', title: '化验设备',align:'center', width: 70},
                    {field: 'ggNo', title: '坩埚号',align:'center', width: 70,hidden:true},
                    {field: 'mypQty', title: '坩埚重量',align:'center', width: 70},
                    {field: 'totalQty', title: '坩埚样品重量(化验前)',align:'center', width: 90},
                    {field: 'afterDryQty', title: '坩埚样品重量(化验后)',align:'center', width: 90},
                    {field: 'indexVal', title: '水分(Mad)',align:'center', width: 70},
                    {field: 'statusName', title: '确认状态',align:'center', width: 70}
                ]
            ]
        })
    });


    function qryIData() {
        var qryBeginDate = $("#iBeginDate").datebox("getValue");
        var qryEndDate =  $("#iEndDate").datebox("getValue");
        var qryStatus = $("#iStatus").combobox("getValue");
//        var qryBatchType = $("#iBatchType").combobox("getValue");
        var qryLaborCode = $("#iLaborCode").textbox("getValue");

        if (qryLaborCode == null || qryLaborCode ==""){
            if ((qryBeginDate ==null || qryBeginDate =="" || qryBeginDate.length==0)
                    ||(qryEndDate ==null || qryEndDate =="" || qryEndDate.length==0)){
                showMsg("提示", "请选择化验编码或化验日期（如果选择化验编码，会加快查询速度）!");
                return false;
            } else {
                if (diffDate(qryBeginDate, qryEndDate) > 10){
                    showMsg("提示", "查询日期跨度不能超过10天!");
                    return false;
                }
            }
        }

        var paramObj = new Object();

        if (qryBeginDate != undefined && qryBeginDate != null && qryBeginDate != "") {
            paramObj.search_beginDate = qryBeginDate;
        }

        if (qryEndDate != undefined && qryEndDate != null && qryEndDate != "") {
            paramObj.search_endDate = qryEndDate;
        }

        if (qryStatus != null && qryStatus != undefined && qryStatus != "") {
            paramObj.search_status = qryStatus;
        }

//        if (qryBatchType != null && qryBatchType != undefined && qryBatchType != "") {
//            paramObj.search_batchType = qryBatchType;
//        }

        if (qryLaborCode != null && qryLaborCode != undefined && qryLaborCode != "") {
            paramObj.search_laborCode = qryLaborCode;
        }
        paramObj.search_indexType = 'mad';
        paramObj.search_dataType = 'mad';

        $iDg.datagrid("load",paramObj);
        $labScaleMADDataDg.datagrid("load",paramObj);
    }


    function confirmMad() {
        selectedI = null;
        selectedScaless = null;
        dataType = null;
        var rows =  $iDg.datagrid('getSelections');
        var rows1 =  $labScaleMADDataDg.datagrid('getSelections');
        if (rows.length == 0 && rows1.length==0) {
            showMsg("提示", "请选择确认的化验记录");
            return false;
        }else {
            if (rows.length + rows1.length < 2){
                showMsg("提示", "请至少选择2条水分化验数据！");
                return false;
            }
            selectedI = rows;
            selectedScaless = rows1;
            dataType = 'mad';
        }
        for ( var i = 0; !(i >= rows.length); i++) {
            if (rows[i].status != "0"){
                showMsg("提示", "“已确认”状态的化验数据不能提交确认！");
                return false;
            }
        }
        for ( var i = 0; !(i >= rows1.length); i++) {
            if (rows1[i].status != "0"){
                showMsg("提示", "“已确认”状态的化验数据不能提交确认！");
                return false;
            }
        }
        $('#confirmWin').window({
            modal : true,
            title : '数据录入并提交',
            width : 550,
            height : 300,
            collapsible : false,
            minimizable : false,
            maximizable : true,
            href : '${base}/business/labory/loteditLabData',
            onClose : function() {
                $iDg.datagrid('reload');
                $labScaleMADDataDg.datagrid('reload');
            }
        });
    }
    //////////////////////////////////////////////////水分 end/////////////////////////////////////////////////////////////


    //////////////////////////////////////////////////灰分 begin/////////////////////////////////////////////////////////////
    $labADataDg = $("#labADataDg");
    $labScaleAADDataDg = $("#labScaleAADDataDg");

    $(function () {
        $('#aStatus').combobox({
            panelHeight:'auto',
            valueField:'id',
            textField:'name',
            data: [
                {id: '', name: '全部'},
                {id: '0', name: '未确认', selected: true},
                {id: '1',name: '已确认'}
            ]
        });

//        $('#aBatchType').combobox({
//            panelHeight:'auto',
//            valueField:'id',
//            textField:'name',
//            data: [
//                {id: '', name: '全部', selected: true},
//                {id: '1', name: '第1次化验'},
//                {id: '2', name: '第2次化验'},
//                {id: '3',name: '第3次化验'},
//                {id: '4',name: '第4次化验'}
//            ]
//        });
    });

    //下拉框获取化验编码
    $('#aLaborCode').combobox({
        url: '${base}/business/tool/getComboboxOpt/LABOR_CODE',
        panelHeight:'auto',
        valueField:'id',
        textField:'name',
        onChange: function (n, o) {
            if (n != undefined) {
                document.getElementById("comboboxInputVal").value = n;
            }
        }
    });

    $(function () {
        $labADataDg.datagrid({
            url: "${base}/business/labory/qryIAResOrgData",
            fitColumns: true,
            height: 190,
            width: $(this).width() - 25,
            idField:'id',
            queryParams: {
                search_laborCode:'-1'//默认不查
            },
            rowStyler: function(index,row){
                if (row.ccStatus == '1'){
                    return 'background-color:red;font-weight:bold;';
                }
            },
            columns: [
                [
                    {field: 'id', title: 'ID', width: 10, align:'center',checkbox:true},
                    {field: 'laborCode', title: '化验编码',align:'center', width:100},
//                    {field: 'batchType', title: '化验批次类型',align:'center', width: 70},
                    {field: 'opTime', title: '化验时间',align:'center', width: 130},
                    {field: 'opName', title: '化验人',align:'center', width: 70},
                    {field: 'deviceName', title: '化验设备',align:'center', width: 70},
                    {field: 'aad', title: '灰分(Aad)',align:'center', width: 70},
                    {field: 'statusName', title: '确认状态',align:'center', width: 70}
                ]
            ]
        })
    });


    $(function () {
        $labScaleAADDataDg.datagrid({
            url: "${base}/business/labory/qryScalesResOrgDataNew",
            fitColumns: true,
            height: 190,
            width: $(this).width() - 25,
            idField:'id',
            queryParams: {
                search_laborCode:'-1'//默认不查
            },
            rowStyler: function(index,row){
                if (row.ccStatus == '1'){
                    return 'background-color:red;font-weight:bold;';
                }
            },
            columns: [
                [   {field: 'id', title: 'ID', width: 10, align:'center',checkbox:true},
                    {field: 'laborCode', title: '化验编码',align:'center', width:100},
//                    {field: 'batchType', title: '化验批次类型',align:'center', width: 70},
                    {field: 'opTime', title: '化验时间',align:'center', width: 110},
                    {field: 'opName', title: '化验人',align:'center', width: 70},
                    {field: 'deviceName', title: '化验设备',align:'center', width: 70},
                    {field: 'ggNo', title: '坩埚号',align:'center', width: 70,hidden:true},
                    {field: 'mypQty', title: '坩埚重量',align:'center', width: 70},
                    {field: 'totalQty', title: '坩埚样品重量(化验前)',align:'center', width: 90},
                    {field: 'afterDryQty', title: '坩埚样品重量(化验后)',align:'center', width: 90},
                    {field: 'indexVal', title: '灰分(Aad)',align:'center', width: 70},
                    {field: 'statusName', title: '确认状态',align:'center', width: 70}
                ]
            ]
        })
    });


    function qryAData() {
        var qryBeginDate = $("#aBeginDate").datebox("getValue");
        var qryEndDate =  $("#aEndDate").datebox("getValue");
        var qryStatus = $("#aStatus").combobox("getValue");
//        var qryBatchType = $("#aBatchType").combobox("getValue");
        var qryLaborCode = $("#aLaborCode").textbox("getValue");

        if (qryLaborCode == null || qryLaborCode ==""){
            if ((qryBeginDate ==null || qryBeginDate =="" || qryBeginDate.length==0)
                    ||(qryEndDate ==null || qryEndDate =="" || qryEndDate.length==0)){
                showMsg("提示", "请选择化验编码或化验日期（如果选择化验编码，会加快查询速度）!");
                return false;
            } else {
                if (diffDate(qryBeginDate, qryEndDate) > 10){
                    showMsg("提示", "查询日期跨度不能超过10天!");
                    return false;
                }
            }
        }

        var paramObj = new Object();

        if (qryBeginDate != undefined && qryBeginDate != null && qryBeginDate != "") {
            paramObj.search_beginDate = qryBeginDate;
        }

        if (qryEndDate != undefined && qryEndDate != null && qryEndDate != "") {
            paramObj.search_endDate = qryEndDate;
        }

        if (qryStatus != null && qryStatus != undefined && qryStatus != "") {
            paramObj.search_status = qryStatus;
        }
//
//        if (qryBatchType != null && qryBatchType != undefined && qryBatchType != "") {
//            paramObj.search_batchType = qryBatchType;
//        }

        if (qryLaborCode != null && qryLaborCode != undefined && qryLaborCode != "") {
            paramObj.search_laborCode = qryLaborCode;
        }
        paramObj.search_indexType = 'aad';
        paramObj.search_dataType = 'aad';

        $labADataDg.datagrid("load",paramObj);
        $labScaleAADDataDg.datagrid("load",paramObj);
    }


    function confirmAad() {
        selectedA = null;
        selectedScaless = null;
        dataType = null;
        var rows =  $labADataDg.datagrid('getSelections');
        var rows1 =  $labScaleAADDataDg.datagrid('getSelections');
        if (rows.length == 0 && rows1.length==0) {
            showMsg("提示", "请选择确认的化验记录");
            return false;
        }else {
            if (rows.length + rows1.length < 2){
                showMsg("提示", "请至少选择2条灰分化验数据！");
                return false;
            }
            selectedA = rows;
            selectedScaless = rows1;
            dataType = 'aad';
        }
        for ( var i = 0; !(i >= rows.length); i++) {
            if (rows[i].status != "0"){
                showMsg("提示", "“已确认”状态的化验数据不能提交确认！");
                return false;
            }
        }
        for ( var i = 0; !(i >= rows1.length); i++) {
            if (rows1[i].status != "0"){
                showMsg("提示", "“已确认”状态的化验数据不能提交确认！");
                return false;
            }
        }
        $('#confirmWin').window({
            modal : true,
            title : '数据录入并提交',
            width : 550,
            height : 300,
            collapsible : false,
            minimizable : false,
            maximizable : true,
            href : '${base}/business/labory/loteditLabData',
            onClose : function() {
                $labADataDg.datagrid('reload');
                $labScaleAADDataDg.datagrid('reload');
            }
        });
    }
    //////////////////////////////////////////////////灰分 end/////////////////////////////////////////////////////////////


    //////////////////////////////////////////////////挥发分 begin/////////////////////////////////////////////////////////////
    $labVDataDg = $("#labVDataDg");
    $labScaleVADDataDg = $("#labScaleVADDataDg");

    $(function () {
        $('#vStatus').combobox({
            panelHeight:'auto',
            valueField:'id',
            textField:'name',
            data: [
                {id: '', name: '全部'},
                {id: '0', name: '未确认', selected: true},
                {id: '1',name: '已确认'}
            ]
        });

//        $('#vBatchType').combobox({
//            panelHeight:'auto',
//            valueField:'id',
//            textField:'name',
//            data: [
//                {id: '', name: '全部', selected: true},
//                {id: '1', name: '第1次化验'},
//                {id: '2', name: '第2次化验'},
//                {id: '3',name: '第3次化验'},
//                {id: '4',name: '第4次化验'}
//            ]
//        });
    });

    //下拉框获取化验编码
    $('#vLaborCode').combobox({
        url: '${base}/business/tool/getComboboxOpt/LABOR_CODE',
        panelHeight:'auto',
        valueField:'id',
        textField:'name',
        onChange: function (n, o) {
            if (n != undefined) {
                document.getElementById("comboboxInputVal").value = n;
            }
        }
    });

    $(function () {
        $labVDataDg.datagrid({
            url: "${base}/business/labory/qryIAResOrgData",
            fitColumns: true,
            height: 190,
            width: $(this).width() - 25,
            idField:'id',
            queryParams: {
                search_laborCode:'-1'//默认不查
            },
            rowStyler: function(index,row){
                if (row.ccStatus == '1'){
                    return 'background-color:red;font-weight:bold;';
                }
            },
            columns: [
                [
                    {field: 'id', title: 'ID', width: 10, align:'center',checkbox:true},
                    {field: 'laborCode', title: '化验编码',align:'center', width:100},
//                    {field: 'batchType', title: '化验批次类型',align:'center', width: 70},
                    {field: 'opTime', title: '化验时间',align:'center', width: 130},
                    {field: 'opName', title: '化验人',align:'center', width: 70},
                    {field: 'deviceName', title: '化验设备',align:'center', width: 70},
                    {field: 'vad', title: '挥发分(Vad)',align:'center', width: 70},
                    {field: 'statusName', title: '确认状态',align:'center', width: 70}
                ]
            ]
        })
    });


    $(function () {
        $labScaleVADDataDg.datagrid({
            url: "${base}/business/labory/qryScalesResOrgDataNew",
            fitColumns: true,
            height: 190,
            width: $(this).width() - 25,
            idField:'id',
            queryParams: {
                search_laborCode:'-1'//默认不查
            },
            rowStyler: function(index,row){
                if (row.ccStatus == '1'){
                    return 'background-color:red;font-weight:bold;';
                }
            },
            columns: [
                [   {field: 'id', title: 'ID', width: 10, align:'center',checkbox:true},
                    {field: 'laborCode', title: '化验编码',align:'center', width:100},
//                    {field: 'batchType', title: '化验批次类型',align:'center', width: 70},
                    {field: 'opTime', title: '化验时间',align:'center', width: 110},
                    {field: 'opName', title: '化验人',align:'center', width: 70},
                    {field: 'deviceName', title: '化验设备',align:'center', width: 70},
                    {field: 'ggNo', title: '坩埚号',align:'center', width: 70,hidden:true},
                    {field: 'mypQty', title: '坩埚重量',align:'center', width: 70},
                    {field: 'totalQty', title: '坩埚样品重量(化验前)',align:'center', width: 90},
                    {field: 'afterDryQty', title: '坩埚样品重量(化验后)',align:'center', width: 90},
                    {field: 'indexVal', title: '挥发分(Vad)',align:'center', width: 70},
                    {field: 'statusName', title: '确认状态',align:'center', width: 70}
                ]
            ]
        })
    });


    function qryVData() {
        var qryBeginDate = $("#vBeginDate").datebox("getValue");
        var qryEndDate =  $("#vEndDate").datebox("getValue");
        var qryStatus = $("#vStatus").combobox("getValue");
//        var qryBatchType = $("#vBatchType").combobox("getValue");
        var qryLaborCode = $("#vLaborCode").textbox("getValue");

        if (qryLaborCode == null || qryLaborCode ==""){
            if ((qryBeginDate ==null || qryBeginDate =="" || qryBeginDate.length==0)
                    ||(qryEndDate ==null || qryEndDate =="" || qryEndDate.length==0)){
                showMsg("提示", "请选择化验编码或化验日期（如果选择化验编码，会加快查询速度）!");
                return false;
            } else {
                if (diffDate(qryBeginDate, qryEndDate) > 10){
                    showMsg("提示", "查询日期跨度不能超过10天!");
                    return false;
                }
            }
        }

        var paramObj = new Object();

        if (qryBeginDate != undefined && qryBeginDate != null && qryBeginDate != "") {
            paramObj.search_beginDate = qryBeginDate;
        }

        if (qryEndDate != undefined && qryEndDate != null && qryEndDate != "") {
            paramObj.search_endDate = qryEndDate;
        }

        if (qryStatus != null && qryStatus != undefined && qryStatus != "") {
            paramObj.search_status = qryStatus;
        }

//        if (qryBatchType != null && qryBatchType != undefined && qryBatchType != "") {
//            paramObj.search_batchType = qryBatchType;
//        }

        if (qryLaborCode != null && qryLaborCode != undefined && qryLaborCode != "") {
            paramObj.search_laborCode = qryLaborCode;
        }
        paramObj.search_indexType = 'vad';
        paramObj.search_dataType = 'vad';

        $labVDataDg.datagrid("load",paramObj);
        $labScaleVADDataDg.datagrid("load",paramObj);
    }


    function confirmVad() {
        selectedV = null;
        selectedScaless = null;
        dataType = null;
        var rows =  $labVDataDg.datagrid('getSelections');
        var rows1 =  $labScaleVADDataDg.datagrid('getSelections');
        if (rows.length == 0 && rows1.length ==0) {
            showMsg("提示", "请选择确认的化验记录");
            return false;
        }else {
            if (rows.length + rows1.length < 2){
                showMsg("提示", "请至少选择2条挥发分化验数据！");
                return false;
            }
            selectedV = rows;
            selectedScaless = rows1;
            dataType = 'vad';
        }
        for ( var i = 0; !(i >= rows.length); i++) {
            if (rows[i].status != "0"){
                showMsg("提示", "“已确认”状态的化验数据不能提交确认！");
                return false;
            }
        }
        for ( var i = 0; !(i >= rows1.length); i++) {
            if (rows1[i].status != "0"){
                showMsg("提示", "“已确认”状态的化验数据不能提交确认！");
                return false;
            }
        }
        $('#confirmWin').window({
            modal : true,
            title : '数据录入并提交',
            width : 550,
            height : 300,
            collapsible : false,
            minimizable : false,
            maximizable : true,
            href : '${base}/business/labory/loteditLabData',
            onClose : function() {
                $labVDataDg.datagrid('reload');
                $labScaleVADDataDg.datagrid('reload');
            }
        });
    }

    function calVad(){
        var qryLaborCode = $("#vLaborCode").textbox("getValue");

        if (qryLaborCode == undefined || qryLaborCode == null || qryLaborCode == "") {
            showMsg("提示", "请先选择化验编码进行查询后再计算");
            return false;
        }

        //取值
        var paramObj = new Object();
        paramObj.search_laborCode = qryLaborCode;
        $.messager.confirm('提示', '确定要计算挥发分【化验编码：'+qryLaborCode+'】?', function (r) {
            if (r) {
                //打开遮罩
                $.messager.progress({ msg: '正在计算，请稍候...' });
                $.post("${base}/business/labory/calcVad", paramObj, function(rsp) {
                    if(rsp.successful){
                        //关闭遮罩
                        $.messager.progress('close');
                        showMsg("提示", rsp.msg);
                        $labScaleVADDataDg.datagrid('reload');
                    } else {
                        //关闭遮罩
                        $.messager.progress('close');
                        showMsg("提示", rsp.msg);
                    }
                });
            }
        });
    }
    //////////////////////////////////////////////////挥发分 end/////////////////////////////////////////////////////////////


    //////////////////////////////////////////////////定硫仪 begin/////////////////////////////////////////////////////////////
    $sDg = $("#labSDataDg");
    $(function () {
        $('#sStatus').combobox({
            panelHeight:'auto',
            valueField:'id',
            textField:'name',
            data: [
                {id: '', name: '全部'},
                {id: '0', name: '未确认', selected: true},
                {id: '1',name: '已确认'}
            ]
        });

//        $('#sBatchType').combobox({
//            panelHeight:'auto',
//            valueField:'id',
//            textField:'name',
//            data: [
//                {id: '', name: '全部', selected: true},
//                {id: '1', name: '第1次化验'},
//                {id: '2', name: '第2次化验'},
//                {id: '3',name: '第3次化验'},
//                {id: '4',name: '第4次化验'}
//            ]
//        });
    });

    //下拉框获取化验编码
    $('#sLaborCode').combobox({
        url: '${base}/business/tool/getComboboxOpt/LABOR_CODE',
        panelHeight:'auto',
        valueField:'id',
        textField:'name',
        onChange: function (n, o) {
            if (n != undefined) {
                document.getElementById("comboboxInputVal").value = n;
            }
        }
    });

    $(function () {
        $sDg.datagrid({
            url: "${base}/business/labory/qrySResOrgData",
            fitColumns: true,//此处一定不要自适应
            height: 430,
            width: $(this).width() - 25,
            idField:'id',
            queryParams: {
                search_laborCode:'-1'//默认不查
            },
            rowStyler: function(index,row){
                if (row.ccStatus == '1'){
                    return 'background-color:red;font-weight:bold;';
                }
            },
            frozenColumns: [
                [   {field: 'id', title: 'ID', width: 10, align:'center',checkbox:true},
                    {field: 'laborCode', title: '化验编码',align:'center', width:100},
                    {field: 'statusName', title: '确认状态',align:'center', width: 70},
//                    {field: 'batchType', title: '化验批次类型',align:'center', width: 100},
                    {field: 'opTime', title: '化验时间',align:'center', width: 130},
                    {field: 'opName', title: '化验人',align:'center', width: 70}

                ]
            ],
            columns: [
                [
                    {field: 'temperature', title: '温度',align:'center', width: 70},
                    {field: 'humidity', title: '湿度',align:'center', width: 70},
                    {field: 'samplingWeight', title: '试样重量',align:'center', width: 70},
                    {field: 'stAd', title: '全硫(St,ad)',align:'center', width: 70},
                    {field: 'deviceName', title: '化验设备',align:'center', width: 70}
                ]
            ],
            toolbar: '#tbs'
        })
    });


    function qrySData() {
        var qryBeginDate = $("#sBeginDate").datebox("getValue");
        var qryEndDate =  $("#sEndDate").datebox("getValue");
        var qryStatus = $("#sStatus").combobox("getValue");
//        var qryBatchType = $("#sBatchType").combobox("getValue");
        var qryLaborCode = $("#sLaborCode").textbox("getValue");

        if (qryLaborCode == null || qryLaborCode ==""){
            if ((qryBeginDate ==null || qryBeginDate =="" || qryBeginDate.length==0)
                    ||(qryEndDate ==null || qryEndDate =="" || qryEndDate.length==0)){
                showMsg("提示", "请选择化验编码或化验日期（如果选择化验编码，会加快查询速度）!");
                return false;
            } else {
                if (diffDate(qryBeginDate, qryEndDate) > 10){
                    showMsg("提示", "查询日期跨度不能超过10天!");
                    return false;
                }
            }
        }

        var paramObj = new Object();

        if (qryBeginDate != undefined && qryBeginDate != null && qryBeginDate != "") {
            paramObj.search_beginDate = qryBeginDate;
        }

        if (qryEndDate != undefined && qryEndDate != null && qryEndDate != "") {
            paramObj.search_endDate = qryEndDate;
        }

        if (qryStatus != null && qryStatus != undefined && qryStatus != "") {
            paramObj.search_status = qryStatus;
        }

//        if (qryBatchType != null && qryBatchType != undefined && qryBatchType != "") {
//            paramObj.search_batchType = qryBatchType;
//        }

        if (qryLaborCode != null && qryLaborCode != undefined && qryLaborCode != "") {
            paramObj.search_laborCode = qryLaborCode;
        }
        $sDg.datagrid("load",paramObj);
    }

    function deleteSRows() {
        var rows =  $sDg.datagrid('getSelections');
        if (rows.length == 0) {
            showMsg("提示", "选择要提交的化验数据记录");
            return false;
        }
        //取值
        var effectRow = new Object();
        effectRow["updated"] = JSON.stringify(rows);
        $.messager.confirm('提示', '相关化验批次的数据失效，确定继续?', function (r) {
            if (r) {
                //提交数据   s表示定硫仪
                $.post("${base}/business/labory/deleteLabData/S", effectRow, function(rsp) {
                    if(rsp.successful){
                        showMsg("提示", rsp.msg+"  当前数据已失效。");
                        $sDg.datagrid('reload');
                        $sDg.datagrid('clearChecked');
                        $sDg.datagrid('clearSelections');
                    } else {
                        showMsg("提示", rsp.msg);
                    }
                });
            }
        });

    }
    function addLotSRows() {
        selectedS = null;
        dataType = null;
        var rows =  $sDg.datagrid('getSelections');
        if (rows.length == 0) {
            showMsg("提示", "请选择确认的化验记录");
            return false;
        }else {
            selectedS = rows;
            dataType = 'S';
        }
        for ( var i = 0; !(i >= rows.length); i++) {
            if (rows[i].status != "0"){
                showMsg("提示", "“已确认”状态的化验数据不能提交确认！");
                return false;
            }
        }
        $('#confirmWin').window({
            modal : true,
            title : '数据录入并提交',
            width : 450,
            height : 200,
            collapsible : false,
            minimizable : false,
            maximizable : true,
            href : '${base}/business/labory/loteditLabData',
            onClose : function() {
                $sDg.datagrid('reload');
            }
        });
    }
    //////////////////////////////////////////////////定硫仪 end/////////////////////////////////////////////////////////////


    //////////////////////////////////////////////////量热仪 begin/////////////////////////////////////////////////////////////
    $hotDg = $("#labHotDataDg");
    $(function () {
        $('#hStatus').combobox({
            panelHeight:'auto',
            valueField:'id',
            textField:'name',
            data: [
                {id: '', name: '全部'},
                {id: '0', name: '未确认', selected: true},
                {id: '1',name: '已确认'}
            ]
        });


//        $('#hBatchType').combobox({
//            panelHeight:'auto',
//            valueField:'id',
//            textField:'name',
//            data: [
//                {id: '', name: '全部', selected: true},
//                {id: '1', name: '初次化验'},
//                {id: '2', name: '抽样第1次'},
//                {id: '3',name: '抽样第2次'},
//                {id: '4',name: '抽样第3次'}
//            ]
//        });
    });

    //下拉框获取化验编码
    $('#hLaborCode').combobox({
        url: '${base}/business/tool/getComboboxOpt/LABOR_CODE',
        panelHeight:'auto',
        valueField:'id',
        textField:'name',
        onChange: function (n, o) {
            if (n != undefined) {
                document.getElementById("comboboxInputVal").value = n;
            }
        }
    });

    $(function () {
        $hotDg.datagrid({
            url: "${base}/business/labory/qryHotResOrgData",
            fitColumns: true,//此处一定不要自适应
            height: 430,
            width: $(this).width() - 25,
            idField:'id',
            queryParams: {
                search_laborCode:'-1'//默认不查
            },
            rowStyler: function(index,row){
                if (row.ccStatus == '1'){
                    return 'background-color:red;font-weight:bold;';
                }
            },
            frozenColumns: [
                [   {field: 'id', title: 'ID', width: 10, align:'center',checkbox:true},
                    {field: 'laborCode', title: '化验编码',align:'center', width:100},
                    {field: 'statusName', title: '确认状态',align:'center', width: 70},
//                    {field: 'batchType', title: '化验批次类型',align:'center', width: 100},
                    {field: 'opTime', title: '化验时间',align:'center', width: 130},
                    {field: 'opName', title: '化验人',align:'center', width: 70}
                ]
            ],
            columns: [
                [
                    {field: 'qbAd', title: '弹筒热(Qb,ad)',align:'center', width: 70},
                    {field: 'deviceName', title: '化验设备',align:'center', width: 70}
                ]
            ],
            toolbar: '#tbhot'
        })
    });

    function qryHotData() {
        var qryBeginDate = $("#hBeginDate").datebox("getValue");
        var qryEndDate =  $("#hEndDate").datebox("getValue");
        var qryStatus = $("#hStatus").combobox("getValue");
//        var qryBatchType = $("#hBatchType").combobox("getValue");
        var qryLaborCode = $("#hLaborCode").textbox("getValue");

        if (qryLaborCode == null || qryLaborCode ==""){
            if ((qryBeginDate ==null || qryBeginDate =="" || qryBeginDate.length==0)
                    ||(qryEndDate ==null || qryEndDate =="" || qryEndDate.length==0)){
                showMsg("提示", "请选择化验编码或化验日期（如果选择化验编码，会加快查询速度）!");
                return false;
            } else {
                if (diffDate(qryBeginDate, qryEndDate) > 10){
                    showMsg("提示", "查询日期跨度不能超过10天!");
                    return false;
                }
            }
        }

        var paramObj = new Object();

        if (qryBeginDate != undefined && qryBeginDate != null && qryBeginDate != "") {
            paramObj.search_beginDate = qryBeginDate;
        }

        if (qryEndDate != undefined && qryEndDate != null && qryEndDate != "") {
            paramObj.search_endDate = qryEndDate;
        }

        if (qryStatus != null && qryStatus != undefined && qryStatus != "") {
            paramObj.search_status = qryStatus;
        }

//        if (qryBatchType != null && qryBatchType != undefined && qryBatchType != "") {
//            paramObj.search_batchType = qryBatchType;
//        }

        if (qryLaborCode != null && qryLaborCode != undefined && qryLaborCode != "") {
            paramObj.search_laborCode = qryLaborCode;
        }
        $hotDg.datagrid("load",paramObj);
    }


    //保存定硫仪修改数据
    function deleteHotRows() {

        //处理选择的数据
        var rows =  $hotDg.datagrid('getSelections');
        if (rows.length == 0) {
            showMsg("提示", "选择要提交的化验数据记录");
            return false;
        }

        //取值
        var effectRow = new Object();
        effectRow["updated"] = JSON.stringify(rows);
        $.messager.confirm('提示', '相关化验批次的数据失效，确定继续?', function (r) {
            if (r) {
                //提交数据   s表示定硫仪
                $.post("${base}/business/labory/deleteLabData/HOT", effectRow, function(rsp) {
                    if(rsp.successful){
                        showMsg("提示", rsp.msg+"  当前数据已失效。");
                        $hotDg.datagrid('acceptChanges');
                        $hotDg.datagrid('reload');
                        $hotDg.datagrid('clearChecked');
                        $hotDg.datagrid('clearSelections');
                    } else {
                        showMsg("提示", rsp.msg);
                    }
                });
            }
        });

    }


    function addLotHotRows() {
        selectedHot = null;
        dataType = null;
        var rows =  $hotDg.datagrid('getSelections');
        if (rows.length == 0) {
            showMsg("提示", "请选择确认的化验记录");
            return false;
        }else {
            selectedHot = rows;
            dataType = 'Hot';
        }
        for ( var i = 0; !(i >= rows.length); i++) {
            if (rows[i].status != "0"){
                showMsg("提示", "“已确认”状态的化验数据不能提交确认！");
                return false;
            }
        }
        $('#confirmWin').window({
            modal : true,
            title : '数据录入并提交',
            width : 450,
            height : 200,
            collapsible : false,
            minimizable : false,
            maximizable : true,
            href : '${base}/business/labory/loteditLabData',
            onClose : function() {
                $hotDg.datagrid('reload');
            }
        });
    }
    //////////////////////////////////////////////////量热仪 end/////////////////////////////////////////////////////////////

    //////////////////////////////////////////////////红外测氢仪 begin/////////////////////////////////////////////////////////////
//    $hwDg = $("#labHwDataDg");
//    $(function () {
//        $('#hwStatus').combobox({
//            panelHeight:'auto',
//            valueField:'id',
//            textField:'name',
//            data: [
//                {id: '', name: '全部'},
//                {id: '0', name: '未确认', selected: true},
//                {id: '1',name: '已确认'}
//            ]
//        });
//
//
//        $('#hwBatchType').combobox({
//            panelHeight:'auto',
//            valueField:'id',
//            textField:'name',
//            data: [
//                {id: '', name: '全部', selected: true},
//                {id: '1', name: '第1次化验'},
//                {id: '2', name: '第2次化验'},
//                {id: '3',name: '第3次化验'},
//                {id: '4',name: '第4次化验'}
//            ]
//        });
//    });
//
//    //下拉框获取化验编码
//    $('#hwLaborCode').combobox({
//        url: '${base}/business/tool/getComboboxOpt/LABOR_CODE',
//        panelHeight:'auto',
//        valueField:'id',
//        textField:'name'
//    });
//
//
//    $(function () {
//        $hwDg.datagrid({
//            url: "${base}/business/labory/qryHwResOrgData",
//            fitColumns: true,//此处一定不要自适应
//            height: 430,
//            width: $(this).width() - 25,
//            idField:'id',
//            queryParams: {
//                search_laborCode:'-1'//默认不查
//            },
//            rowStyler: function(index,row){
//                if (row.ccVal >=1){
//                    return 'background-color:red;font-weight:bold;';
//                }
//            },
//            frozenColumns: [
//                [   {field: 'id', title: 'ID', width: 10, align:'center',checkbox:true},
//                    {field: 'laborCode', title: '化验编码',align:'center', width:100},
//                    {field: 'statusName', title: '确认状态',align:'center', width: 70},
//                    {field: 'batchType', title: '化验批次类型',align:'center', width: 100},
//                    {field: 'opTime', title: '化验时间',align:'center', width: 130},
//                    {field: 'opName', title: '化验人',align:'center', width: 70}
//                ]
//            ],
//            columns: [
//                [
//                    {field: 'standard', title: '执行标准',align:'center', width: 100,hidden:true},
//                    {field: 'temperature', title: '温度',align:'center', width: 70,hidden:true},
//                    {field: 'humidity', title: '湿度',align:'center', width: 70,hidden:true},
//                    {field: 'samplingName', title: '试样名称',align:'center', width: 70,hidden:true},
//                    {field: 'had', title: '空干基氢',align:'center', width: 70},
//                    {field: 'hd', title: '干基氢',align:'center', width: 70},
//                    {field: 'samplingWeight', title: '试样重量',align:'center', width: 70},
////                    {field: 'ggNo', title: '坩埚号',align:'center', width: 70,hidden:true},
//                    {field: 'cad', title: '空干基碳',align:'center', width: 70},
//                    {field: 'cd', title: '干基碳',align:'center', width: 70},
//                    {field: 'mad', title: '水分',align:'center', width: 70,hidden:true},
//                    {field: 'method', title: '方法',align:'center', width: 70,hidden:true},
//                    {field: 'ccVal', title: '超差',align:'center', width: 70,hidden:true},
//                    {field: 'deviceName', title: '化验设备',align:'center', width: 70}
//                ]
//            ],
//            toolbar: '#tbhw'
//        })
//    });
//
//
//    function qryhwData() {
//        var qryBeginDate = $("#hwBeginDate").datebox("getValue");
//        var qryEndDate =  $("#hwEndDate").datebox("getValue");
//        var qryStatus = $("#hwStatus").combobox("getValue");
//        var qryBatchType = $("#hwBatchType").combobox("getValue");
//        var qryLaborCode = $("#hwLaborCode").textbox("getValue");
//
//        if (qryLaborCode == null || qryLaborCode ==""){
//            if ((qryBeginDate ==null || qryBeginDate =="" || qryBeginDate.length==0)
//                    ||(qryEndDate ==null || qryEndDate =="" || qryEndDate.length==0)){
//                showMsg("提示", "请选择化验编码或化验日期（如果选择化验编码，会加快查询速度）!");
//                return false;
//            } else {
//                if (diffDate(qryBeginDate, qryEndDate) > 10){
//                    showMsg("提示", "查询日期跨度不能超过10天!");
//                    return false;
//                }
//            }
//        }
//
//        var paramObj = new Object();
//
//        if (qryBeginDate != undefined && qryBeginDate != null && qryBeginDate != "") {
//            paramObj.search_beginDate = qryBeginDate;
//        }
//
//        if (qryEndDate != undefined && qryEndDate != null && qryEndDate != "") {
//            paramObj.search_endDate = qryEndDate;
//        }
//
//        if (qryStatus != null && qryStatus != undefined && qryStatus != "") {
//            paramObj.search_status = qryStatus;
//        }
//
//        if (qryBatchType != null && qryBatchType != undefined && qryBatchType != "") {
//            paramObj.search_batchType = qryBatchType;
//        }
//
//        if (qryLaborCode != null && qryLaborCode != undefined && qryLaborCode != "") {
//            paramObj.search_laborCode = qryLaborCode;
//        }
//        $hwDg.datagrid("load",paramObj);
//    }
//
//    //保存定硫仪修改数据
//    function deletehwRows() {
//
//        //处理选择的数据
//        var rows =  $hwDg.datagrid('getSelections');
//        if (rows.length == 0) {
//            showMsg("提示", "选择要提交的化验数据记录");
//            return false;
//        }
//
//        //取值
//        var effectRow = new Object();
//        effectRow["updated"] = JSON.stringify(rows);
//        $.messager.confirm('提示', '相关化验批次的数据失效，确定继续?', function (r) {
//            if (r) {
//                //提交数据   s表示定硫仪
//                $.post("${base}/business/labory/deleteLabData/HW", effectRow, function(rsp) {
//                    if(rsp.successful){
//                        showMsg("提示", rsp.msg+"  当前数据已失效。");
//                        $hwDg.datagrid('acceptChanges');
//                        $hwDg.datagrid('reload');
//                        $hwDg.datagrid('clearChecked');
//                        $hwDg.datagrid('clearSelections');
//                    } else {
//                        showMsg("提示", rsp.msg);
//                    }
//                }, "JSON").error(function() {
//                            showMsg("提示", "保存失败！");
//                        });
//            }
//        });
//    }
//
//    function addLothwRows() {
//        selectedHw = null;
//        dataType = null;
//        var rows =  $hwDg.datagrid('getSelections');
//        if (rows.length == 0) {
//            showMsg("提示", "请选择确认的化验记录");
//            return false;
//        }else {
//            selectedHw = rows;
//            dataType = 'Hw';
//        }
//        for ( var i = 0; !(i >= rows.length); i++) {
//            if (rows[i].status != "0"){
//                showMsg("提示", "“已确认”状态的化验数据不能提交确认！");
//                return false;
//            }
//        }
//        $('#confirmWin').window({
//            modal : true,
//            title : '数据录入并提交',
//            width : 450,
//            height : 200,
//            collapsible : false,
//            minimizable : false,
//            maximizable : true,
//            href : '${base}/business/labory/loteditLabData',
//            onClose : function() {
//                $hwDg.datagrid('reload');
//            }
//        });
//    }
//    //////////////////////////////////////////////////红外测氢仪 end///////////////////////////////////////////////////////////////
//
//
//    //////////////////////////////////////////////////灰熔融测定仪 begin/////////////////////////////////////////////////////////////
//    $labMeltDataDg = $("#labMeltDataDg");
//    $(function () {
//        $("#meltStatus").combobox({
//            panelHeight:'auto',
//            valueField:'id',
//            textField:'name',
//            data: [
//                {id: '', name: '全部'},
//                {id: '0', name: '未确认', selected: true},
//                {id: '1',name: '已确认'}
//            ]
//        });
//
//
//        $('#meltBatchType').combobox({
//            panelHeight:'auto',
//            valueField:'id',
//            textField:'name',
//            data: [
//                {id: '', name: '全部', selected: true},
//                {id: '1', name: '第1次化验'},
//                {id: '2', name: '第2次化验'},
//                {id: '3',name: '第3次化验'},
//                {id: '4',name: '第4次化验'}
//            ]
//        });
//    });
//
//    //下拉框获取化验编码
//    $('#meltLaborCode').combobox({
//        url: '${base}/business/tool/getComboboxOpt/LABOR_CODE',
//        panelHeight:'auto',
//        valueField:'id',
//        textField:'name'
//    });
//
//
//    $(function () {
//        $labMeltDataDg.datagrid({
//            url: "${base}/business/labory/qryMeltResOrgData",
//            fitColumns: true,//此处一定不要自适应
//            height: 430,
//            width: $(this).width() - 25,
//            idField:'id',
//            queryParams: {
//                search_laborCode:'-1'//默认不查
//            },
//            rowStyler: function(index,row){
//                if (row.ccVal >=1){
//                    return 'background-color:red;font-weight:bold;';
//                }
//            },
//            frozenColumns: [
//                [   {field: 'id', title: 'ID', width: 10, align:'center',checkbox:true},
//                    {field: 'laborCode', title: '化验编码',align:'center', width:100},
//                    {field: 'statusName', title: '确认状态',align:'center', width: 70},
//                    {field: 'batchType', title: '化验批次类型',align:'center', width: 100},
//                    {field: 'opTime', title: '化验时间',align:'center', width: 130},
//                    {field: 'opName', title: '化验人',align:'center', width: 70}
//                ]
//            ],
//            columns: [
//                [
//                    {field: 'standard', title: '执行标准',align:'center', width: 100 ,hidden:true},
//                    {field: 'temperature', title: '温度',align:'center', width: 70,hidden:true},
//                    {field: 'humidity', title: '湿度',align:'center', width: 70,hidden:true},
//                    {field: 'adStyle', title: '气氛条件',align:'center', width: 70},
//                    {field: 'dt', title: '变形温度',align:'center', width: 70},
//                    {field: 'st', title: '软化温度',align:'center', width: 70},
//                    {field: 'ht', title: '半球温度',align:'center', width: 70},
//                    {field: 'ft', title: '流动温度',align:'center', width: 70},
//                    {field: 'ccVal', title: '超差',align:'center', width: 70,hidden:true},
//                    {field: 'deviceName', title: '化验设备',align:'center', width: 70}
//                ]
//            ],
//            toolbar: '#tbMelt'
//        })
//    });
//
//    function qryMeltData() {
//        var qryBeginDate = $("#meltBeginDate").datebox("getValue");
//        var qryEndDate =  $("#meltEndDate").datebox("getValue");
//        var qryStatus = $("#meltStatus").combobox("getValue");
//        var qryBatchType = $("#meltBatchType").combobox("getValue");
//        var qryLaborCode = $("#meltLaborCode").textbox("getValue");
//
//        if (qryLaborCode == null || qryLaborCode ==""){
//            if ((qryBeginDate ==null || qryBeginDate =="" || qryBeginDate.length==0)
//                    ||(qryEndDate ==null || qryEndDate =="" || qryEndDate.length==0)){
//                showMsg("提示", "请选择化验编码或化验日期（如果选择化验编码，会加快查询速度）!");
//                return false;
//            } else {
//                if (diffDate(qryBeginDate, qryEndDate) > 10){
//                    showMsg("提示", "查询日期跨度不能超过10天!");
//                    return false;
//                }
//            }
//        }
//
//        var paramObj = new Object();
//
//        if (qryBeginDate != undefined && qryBeginDate != null && qryBeginDate != "") {
//            paramObj.search_beginDate = qryBeginDate;
//        }
//
//        if (qryEndDate != undefined && qryEndDate != null && qryEndDate != "") {
//            paramObj.search_endDate = qryEndDate;
//        }
//
//        if (qryStatus != null && qryStatus != undefined && qryStatus != "") {
//            paramObj.search_status = qryStatus;
//        }
//
//        if (qryBatchType != null && qryBatchType != undefined && qryBatchType != "") {
//            paramObj.search_batchType = qryBatchType;
//        }
//
//        if (qryLaborCode != null && qryLaborCode != undefined && qryLaborCode != "") {
//            paramObj.search_laborCode = qryLaborCode;
//        }
//        $labMeltDataDg.datagrid("load",paramObj);
//    }
//
//
//    //保存天平修改数据
//    function deleteMeltRows() {
//        //处理选择的数据
//        var rows =  $labMeltDataDg.datagrid('getSelections');
//        if (rows.length == 0) {
//            showMsg("提示", "选择要提交的化验数据记录");
//            return false;
//        }
//        var effectRow = new Object();
//        effectRow["updated"] = JSON.stringify(rows);
//
//        $.messager.confirm('提示', '相关化验批次的数据失效，确定继续?', function (r) {
//            if (r) {
//                //提交数据   scales表示天平
//                $.post("${base}/business/labory/deleteLabData/MELT", effectRow, function(rsp) {
//                    if(rsp.successful){
//                        showMsg("提示", rsp.msg+"  当前数据已失效。");
//                        $labMeltDataDg.datagrid('reload');
//                        $labMeltDataDg.datagrid('clearChecked');
//                        $labMeltDataDg.datagrid('clearSelections');
//                    } else {
//                        showMsg("提示", rsp.msg);
//                    }
//                });
//            }
//        });
//    }
//
//
//    function addMeltRows() {
//        selectedMelt = null;
//        dataType = null;
//        var rows =  $labMeltDataDg.datagrid('getSelections');
//        if (rows.length == 0) {
//            showMsg("提示", "请选择确认的化验记录！");
//            return false;
//        }else {
//            selectedMelt = rows;
//            dataType = 'Melt';
//        }
//
//        for ( var i = 0; !(i >= rows.length); i++) {
//            if (rows[i].status != "0"){
//                showMsg("提示", "“已确认”状态的化验数据不能提交确认！");
//                return false;
//            }
//        }
//
//        $('#confirmWin').window({
//            modal : true,
//            title : '数据录入并提交',
//            width : 450,
//            height : 200,
//            collapsible : false,
//            minimizable : false,
//            maximizable : true,
//            href : '${base}/business/labory/loteditLabData',
//            onClose : function() {
//                $labMeltDataDg.datagrid('reload');
//            }
//        });
//    }
    //////////////////////////////////////////////////灰熔融测定仪 end/////////////////////////////////////////////////////////////


    //////////////////////////////////////////////////人工输入值 begin/////////////////////////////////////////////////////////////

        $('#inputLaborCode').combobox({
            url: '${base}/business/tool/getComboboxOpt/LABOR_CODE',
            required:true,
            panelHeight:'auto',
            valueField:'id',
            textField:'name',
            onChange: function (n, o) {
                if (n != undefined) {
                    document.getElementById("comboboxInputVal").value = n;
                }
            }
        });


        //保存天平修改数据
        function submitInput() {
            //处理选择的数据
            var paramObj = new Object();
            var jsonObj = {};
            paramObj.laborCode = $("#inputLaborCode").numberbox("getValue");
            paramObj.had = $("#had").numberbox("getValue");
            paramObj.st = $("#st").numberbox("getValue");

            if (paramObj.laborCode == null || paramObj.laborCode == ""){
                showMsg("提示", "请选择化验编码");
                return false;
            }

            if ((paramObj.st == null || paramObj.st == "") && (paramObj.had == null || paramObj.had == "")) {
                showMsg("提示", "氢值和软化温度至少输入一项指标值才能提交");
                return false;
            }

            if (paramObj.st == null || paramObj.st == ""){
                paramObj.st = "0";
            }

            jsonObj.search_jsonStr = JSON.stringify(paramObj);
            $.messager.confirm('提示', '确定要提交输入的化验指标数据?', function (r) {
                if (r) {
                    //提交数据   scales表示天平
                    $.post("${base}/business/labory/submitInput", jsonObj, function(rsp) {
                        if(rsp.successful){
                            showMsg("提示", rsp.msg);
                            $("#inputLaborCode").combobox("setValue", "");
                            $("#had").numberbox("setValue","");
                            $("#st").numberbox("setValue","");
                        } else {
                            showMsg("提示", rsp.msg);
                        }
                    });
                }
            });
        }
    //////////////////////////////////////////////////人工输入值 end//////////////////////////////////////////////////////////////
</script>