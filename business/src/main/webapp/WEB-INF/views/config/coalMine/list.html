<!DOCTYPE html>
<html>
<head>
    <title>煤矿信息配置</title>
    <base href="${base}/">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
    <meta http-equiv="description" content="this is my page">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <#include "/include/common.html"/>
</head>
<body>
<@shiro.hasPermission name="coalMine:save">
<div class="well" >
    <span class="badge">提示</span>
    在此你可以对<span class="label-info"><strong>煤矿信息</strong></span>进行编辑!
</div>
</@shiro.hasPermission>
<div id="tb" >
    <table>
        <tr>
            <td >
                <@shiro.hasPermission name="coalMine:save">
                <a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-add"
                   onclick="addCoalMine();">添加</a>
                <a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-edit"
                   onclick="editCoalMine();">修改</a>
                <!--<a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-sys" onclick="setVendorMine();">配置</a>-->
            </@shiro.hasPermission>
            <@shiro.hasPermission name="coalMine:delete:coalMine拥有的资源">
            <a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-remove"
               onclick="delRow();">删除</a>
        </@shiro.hasPermission>
        </td>
        <td>
            <input id="searchbox" type="text"/>
        </td>
        </tr>
    </table>
</div>
<div id="mm">
    <div name="search_mineName">煤矿名称</div>
    <div name="search_mineNo">煤矿编号</div>
    <div name="search_forShort">简称</div>
</div>
<div id="tx" style="margin: 5px;">
    <table id="dg" title="煤矿清单" ></table>
</div>
<div id="win" ></div>
<div id="vendorMineWin" ></div>
</body>
<script type="text/javascript">
    var $dg;
    $(function () {
        $dg = $("#dg");
        $('#dg').datagrid({
            iconCls: 'icon-edit',
            fitColumns: true,
            height: $(this).height() - 46,
            width: $(this).width() - 10,
            singleSelect: true,
            idField: 'id',
            url: '${base}/business/config/coalMine/listShow',
            pagination: true,
            rownumbers: true,
            columns: [
                [
                    {field: 'mineNo', title: '煤矿编号', width: 50},
                    {field: 'mineName', title: '煤矿名称', width: 100},
                    {field: 'forShort', title: '简称', width: 50},
                    {field: 'venName', title: '供应商名称', width: 100},
//                    {field: 'area', title: '所属地区', width: 100},
//                    {field: 'transDist', title: '运距', width: 100},
//                    {field: 'transTime', title: '最短运输时间', width: 100},
//                    {field: 'yearOutp', title: '年产量', width: 100},
//                    {field: 'coalNo', title: '煤种', width: 100},
//                    {field: 'lealPerson', title: '法人代表', width: 100},
//                    {field: 'transMode', title: '运输方式', width: 100},
//                    {field: 'mineProp', title: '煤矿属性', width: 100},
                    {field: 'remark', title: '备注', width: 100}
                ]
            ],
            toolbar: '#tb'
        });
        //搜索框
        $("#searchbox").searchbox({
            menu:"#mm",
            prompt :'模糊查询',
            searcher:function(value,name){
                var str="{\"" + name + "\":\"" + value + "\"}";
                var obj = eval('('+str+')');
                $('#dg').datagrid('reload',obj);
            }
        });
    });

    function delRow() {
        var selectedRow = $dg.datagrid('getSelected');
        if (selectedRow) {
            $.messager.confirm('提示', '确定进行操作?', function (r) {
                if (r) {
                    var id = $dg.datagrid('getSelected').mineNo;
//                var id = selectedRow.mineNo;
                    $.post("${base}/business/config/coalMine/delete/" + id, function (rsp) {
                        if (rsp.successful) {
                            $('#dg').datagrid("reload");
                            showMsg("提示", rsp.msg);
                        } else {
                            showMsg("提示", rsp.msg);
                        }
                    }).error(function () {
                        showMsg("提示", "查询数据失败,请重新登陆!");
                    });
                    $dg.datagrid('clearSelections');
                }
            });
        }
        else {
            showMsg("提示", "请选择一行");
            return;
        }
        selectedRow = null;
    }
    function closeWin()
    {
        $('#win').window('close',true);
    }
    function addCoalMine()
    {
        var win = $('#win').window({
            modal : true,
            title : '添加煤矿',
            width : 550,
            height : 370,
            collapsible : false,
            minimizable : false,
            maximizable : true,
            href : '${base}/business/config/coalMineEdit',
            onClose : function() {
                $dg.datagrid('reload');
            }
        });
    }

    function editCoalMine()
    {
        var row =  $dg.datagrid('getSelected');
        if (row) {
            var code  = row.mineNo;
            $('#win').window({
                modal: true,
                title: '编辑煤矿',
                width: 550,
                height: 370,
                collapsible: false,
                minimizable: false,
                maximizable: true,
                href: '${base}/business/config/coalMineEdit/'+code,
                onClose: function () {
                    $dg.datagrid('reload');
                }
            });
        }
        else
        {
            showMsg("提示", "请选择一行");
            return;
        }
    }

    //basicType（0：供应商，1：矿点）
    var basicType = 1;
    function setVendorMine() {
        $('#vendorMineWin').window({
            modal: true,
            title: '编辑供应商矿点',
            width: 550,
            height: 430,
            collapsible: false,
            minimizable: false,
            maximizable: true,
            href: '${base}/business/config/vendorMine/list',
            onClose: function () {
                $dg.datagrid('reload');
            }
        });
    }
</script>
</html>