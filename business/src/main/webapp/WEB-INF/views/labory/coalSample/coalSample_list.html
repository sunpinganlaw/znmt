<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>标煤样品信息</title>
    <#include "../../common/include/common.html"/>
    <style type="text/css">
        /*body {
            background: #fff;
        }*/
    </style>
</head>

<body id="contentDiv" style="overflow-x: hidden;">
<div class="page_content">
    <div class="infoCard infoCard2">
        <div class="attendance_list_operation">
            <!-- 搜索条件在左 -->
            <table border="0" cellspacing="0" cellpadding="0" class="search_content"
                   style="float: left;margin-left: 10px;">
                <tr>
                    <td>样品ID：</td>
                    <td>
                        <div class="selectSuggestion" id="sample_id" name="sample_id" autoCheck="false"
                             url="${base}/mis/base/misEUI.do?businessCode=coal.qrySampleID" dataRoot="rows"
                             selWidth="300" keepDefaultStyle="true"></div>
                    </td>
                    <td>样品名称：</td>
                    <td>
                        <div class="selectSuggestion" id="sample_name" name="sample_name" autoCheck="false"
                             url="${base}/mis/base/misEUI.do?businessCode=coal.qrySampleName" dataRoot="rows"
                             selWidth="300" keepDefaultStyle="true"></div>
                    </td>
                    <td>样品状态：</td>
                    <td>
                        <select id="status" name="status" prompt="请选择"
                                data='{"list":[{"value":"0","key":"有效"},{"value":"1","key":"失效"}]}'
                                selWidth="300"></select>
                    </td>
                </tr>
            </table>
            <!--搜索按钮在右 -->
            <table border="0" cellspacing="0" cellpadding="0" class="search_content">
                <tr>
                    <td>
                        <button type="button" class="primary" onclick="qrySampleList()">
                            <span class="icon_find">查询</span></button>
                    </td>
                    <td>
                        <button type="button" onclick="clearAllIn()"><span class="icon_clear">重置</span></button>
                    </td>
                    <td>
                        <button type="button" class="primary" onclick="add()">
                            <span class="icon_add">新增</span></button>
                    </td>
                </tr>
            </table>
            <div class="clear"></div>
            <div id="dataBasic"></div>
        </div>
    </div>
</div>
</body>
<script type="text/javascript">
    var grid;
    var modulePath = 'business/labory';
    var toolbarItems = [
        {text: '批量删除', click: batchRemove, iconClass: 'icon_delete'},{line : true },
        // {text: '生成标样化验单', click: labReport, iconClass: 'icon_export'},{line : true },
        {text: '刷新', click: refresh, iconClass: 'icon_refresh'},{line : true }
    ];
    /**
     * 初始化函数
     */
    function initComplete() {
        initGrid();
    }

    /**
     * 标煤样品信息表
     */
    function initGrid() {
        var columnDef = [{
            display: '标煤样品ID',
            id: 'sample_id',
            name: 'sample_id',
            width: 135
        }, {
            display: '标煤样品名称',
            name: 'sample_name',
            width: 110
        }, {
            display: '标煤样品状态',
            name: 'status',
            width: 110,
            render: function (rowdata, rowindex, value, column) {
                if (value == '0') {
                    return '<span>有效</span>';
                } else if (value == '1') {
                    return '<span>失效</span>';
                }
            }
        }, {
            display: '启用时间',
            name: 'start_dt',
            width: 100
        }, {
            display: '失效时间',
            name: 'end_dt',
            width: 100
        }, {
            display: '备注说明',
            name: 'remark',
            width: 150
        }, {
            display: '干基灰分上限',
            name: 'ad_upperlimit',
            width: 110
        }, {
            display: '干基灰分下限',
            name: 'ad_lowerlimit',
            width: 110
        }, {
            display: '干基灰分不确定度',
            name: 'ad_uncertainty',
            width: 140
        }, {
            display: '干基挥发分上限',
            name: 'vd_upperlimit',
            width: 125
        }, {
            display: '干基挥发分下限',
            name: 'vd_lowerlimit',
            width: 125
        }, {
            display: '干基挥发分不确定度',
            name: 'vd_uncertainty',
            width: 155
        }, {
            display: '干基硫分上限',
            name: 'std_upperlimit',
            width: 110
        }, {
            display: '干基硫分下限',
            name: 'std_lowerlimit',
            width: 110
        }, {
            display: '干基硫分不确定度',
            name: 'std_uncertainty',
            width: 140
        }, {
            display: '干基高位发热量上限',
            name: 'qgrd_upperlimit',
            width: 155
        }, {
            display: '干基高位发热量下限',
            name: 'qgrd_lowerlimit',
            width: 155
        }, {
            display: '干基高位发热量不确定度',
            name: 'qgrd_uncertainty',
            width: 185
        }, {
            display: '干基氢值上限',
            name: 'hd_upperlimit',
            width: 110
        }, {
            display: '干基氢值下限',
            name: 'hd_lowerlimit',
            width: 110
        }, {
            display: '干基氢值不确定度',
            name: 'hd_uncertainty',
            width: 140
        }, {
            display: '灰熔点上限',
            name: 'st_upperlimit',
            width: 100
        }, {
            display: '灰熔点下限',
            name: 'st_lowerlimit',
            width: 100
        }, {
            display: '灰熔点不确定度',
            name: 'st_uncertainty',
            width: 125
        }, {
            display: '操作',
            name: 'operate',
            align: 'center',
            width: 150,
            isSort: false,
            render: function (rowdata, rowindex, value, column) {
                return '<div  class="grid_opp_container">'
                    + '<span class="grid_opp_edit" onclick="edit(\'' + rowdata.sample_id + '\')">修改</span>'
                    + '<span class="grid_opp_delete" onclick="ondelete(\'' + rowdata.sample_id + '\')">删除</span>';
                    + '</div>';
            }
        }];
        // 请求参数
        var param = {};
        grid = $("#dataBasic").quiGrid({
            columns: columnDef,
            url: "${base}/mis/base/misEUI.do?businessCode=coal.qrySampleList",
            params: param,
            record: "total",
            pageParmName: "page",
            pagesizeParmName: "rows",
            toolbar:{
                items: toolbarItems
            },
            rownumbers: true,
            checkbox: true,
            height: '100%',
            width: "100%",
            pageSize: 10,
            percentWidthMode: false
        });
    }
    function qrySampleList() {
        // 请求参数
        var param = {};
        param.status = $('#status').attr('relValue');
        $.each($(".selectSuggestion"), function (index, item) {
            param[$(item).attr("name")] = $(item).attr("relValue");
        });
        param = deleteEmptyNode(param);
        grid.setOptions({params: param});
        //页号重置为1
        grid.setNewPage(1);
        grid.loadData();
    }

    // 监听查询框的回车事件
    $(document).keyup(function(event){
        if(event.keyCode ==13){
            qrySampleList();//不关闭窗口
        }
    });

    // 新增
    function add() {
        var diag = new top.Dialog();
        diag.Title = "添加标煤样品信息";
        diag.Width = 1550;
        diag.Height = 600;
        diag.URL = modulePath + '/coalSample/addPage',
            diag.OkButtonText = "保 存";
        diag.OKEvent = function() {
            diag.innerFrame.contentWindow.submitHandler();
        };
        diag.show();
    }

    // 修改
    function edit(sampleID) {
        if(sampleID == null || sampleID == '') {
            return;
        }
        var diag = new top.Dialog();
        diag.Title = "修改标煤样品信息";
        diag.Width = 1550;
        diag.Height = 600;
        diag.URL = modulePath + '/coalSample/editPage?sample_id=' + sampleID,
            diag.OkButtonText = "保 存";
        diag.OKEvent = function() {
            diag.innerFrame.contentWindow.submitHandler();
        };
        diag.show();
    }

    //删除

    function ondelete(rowId) {
        //alert(rowId);
        if(rowId == null || rowId == '') {
            return;
        }
        top.Dialog.confirm("确定要删除该记录吗？", function() {
            $.post(modulePath + "/save", {"sample_id": rowId,"tableName": "STANDARD_COAL_SAMPLE","v_doActionTag": "DEL"}, //获取所有选中行
                function(rspData) {
                    var jsonData = rspData;//JSON.parse(rspData);
                    top.Toast(jsonData.success == false ? "showErrorToast" : "showSuccessToast", jsonData.resultMsg);
                    grid.loadData();
                    showCondition(0);
                },
                "json");
        }, null, null, null, 100);
    }

    //批量删除
    function batchRemove() {
        var selectedRows = grid.getSelectedRows();
        var selectedNum = selectedRows.length;
        if (selectedNum == 0) {
            top.Toast("showWarningToast", '请选择要删除的记录');
            return;
        }
        top.Dialog.confirm("确定要删除选中的记录吗？", function() {
            var ids = "";
            for(var i = 0; i<selectedNum; i++) {
                ids += selectedRows[i].sample_id + ",";
            }
            ids = ids.substring(0,ids.length-1);
            $.post(modulePath + "/save", {"sampleIds": ids,"tableName": "STANDARD_COAL_SAMPLE","v_doActionTag": "BDEL"}, //获取所有选中行
                function(rspData) {
                    //alert(rspData);
                    var jsonData = rspData;//JSON.parse(rspData);
                    top.Toast(jsonData.success == false ? "showErrorToast" : "showSuccessToast", jsonData.resultMsg);
                    grid.loadData();
                    showCondition(0);
                },
                "json");
        }, null, null, null, 100);
    }

    //刷新表格数据并重置排序和页数
    function refresh() {
        grid.loadData();
        showCondition(0);
    }

    //生成标样化验单
    function labReport() {

    }
    /*重置查询条件*/
    function clearAllIn() {
        $('.selectSuggestion').render();
        $('#status').attr("relValue",'');
        $('#status').render();
        qrySampleList();
    }

</script>

</html>