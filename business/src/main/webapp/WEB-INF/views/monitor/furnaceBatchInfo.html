<!DOCTYPE html>
<html>
<head>
    <title>入炉批次</title>
    <base href="${base}/">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
    <meta http-equiv="description" content="this is my page">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <#include "/include/common.html"/>
</head>
<body>
<div id="layoutDiv" class="easyui-layout" style="height:100%">
    <div id="tb">

       <label for="sampleCode">采样编码</label>
        <input class="easyui-textbox" id="sampleCode" style="width:145px;" value=""/>
        <label for="samplingCode">制样编码</label>
        <input class="easyui-textbox" id="samplingCode" style="width:145px;" value=""/>
        <label for="startDate">开始时间</label>
        <input class="easyui-datebox" name="startDate" id="startDate"  style="width:145px;"/>
        <label for="endDate">结束时间</label>
        <input class="easyui-datebox" name="endDate" id="endDate"  style="width:145px;"/>
        <span style="margin-left: 0;">
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search"  onclick="qry()">查询</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-add"  onclick="add()">增加</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-edit"  onclick="edit()">修改</a>
         <input type="hidden" id="doActionTag"/>
        </span>

        <input type="hidden" id="doAction" />
        <input type="hidden" id="samplingCodeHidden" />
        <input type="hidden" id="sampleCodeHidden" />
    </div>

    <div data-options="region:'center',title:'入炉批次信息',noheader:false;">
        <table id="sampleCodeDg"></table>
    </div>
</div>

<!--预报查看编辑窗口-->
<div id="furnaceBatchInfoWin" ></div>
</body>
</html>
<script type="text/javascript">
    $sampleCodeDg = $("#sampleCodeDg");
    var rowObject ;
    var selectedRowObj;

    $(function () {
        var myDate = new Date();
        var defaultBeginTime = myDate.getFullYear()+"-"+(parseInt(myDate.getMonth())+1)+"-"+myDate.getDate();
        var defaultEndTime =  myDate.getFullYear()+"-"+(parseInt(myDate.getMonth())+1)+"-"+myDate.getDate();

        $sampleCodeDg.datagrid({
            url:  '${base}/business/monitor/qryFurnaceBatchInfoList',
            animate: true,
            border:true,
            height: $(this).height() - 2,
            width: $(this).width() - 2,
            idField:'batchNo',
            singleSelect:true,
            rownumbers:true,

            pagination: true,
            pagenumber:true,
            pageSize:70,
            pageList: [70, 100],

            queryParams: {//默认进来查当天
                search_startTime:defaultBeginTime,
                search_endTime:defaultEndTime
            },
            columns: [
                [
                    {field: 'batchNo', title: '批次编号',align:'center', width:"200px"},
                    {field: 'sampleCode', title: '采样编码',align:'center', width: "200px"},
                    {field: 'samplingCode', title: '制样编码',align:'center', width: "200px"},
                    {field: 'laborCode', title: '化验码',align:'center', width:"200px"},
                    //{field: 'mineName', title: '矿点',align:'center', width:"200px"},
                    {field: 'coalName', title: '煤种',align:'center', width:"200px"}
                ]
            ],
            toolbar: '#tb'
        })
    });

    function qry(){
        var paramO = new Object();
        var sampleCode = $("#sampleCode").textbox("getValue");
        var samplingCode = $("#samplingCode").textbox("getValue");
        var startTime = $("#startDate").datebox("getValue");
        var endTime = $("#endDate").datebox("getValue");

        if (sampleCode != null && sampleCode != "" && sampleCode.length > 0) {
            paramO.search_sampleCode = sampleCode;
        }
        if (samplingCode != null && samplingCode != "" && samplingCode.length > 0) {
            paramO.search_samplingCode = samplingCode;
        }
        if (startTime != null && startTime != "" && startTime.length > 0) {
            paramO.search_startTime = startTime;
        }
        if (endTime != null && endTime != "" && endTime.length > 0) {
            paramO.search_endTime = endTime;
        }
        $sampleCodeDg.datagrid("load",paramO);
    }

    //新增
    function add(){
        document.getElementById("doActionTag").value = "ADD";
        $('#furnaceBatchInfoWin').window({
            modal : true,
            title : '入炉批次信息录入',
            width : 450,
            height : 110,
            collapsible : false,
            minimizable : false,
            maximizable : true,
            href : '${base}/business/monitor/addFurnaceBatchInfo',
            onClose : function() {
                refreshDg();
            }
        });
    }

    //修改记录
    function edit(){
        var selectedRow = $("#sampleCodeDg").datagrid('getSelected');
        if (selectedRow) {
            document.getElementById("doActionTag").value = "MOD";
            selectedRowObj = selectedRow;

            $('#furnaceBatchInfoWin').window({
                modal : true,
                title : '入炉批次信息修改',
                width : 450,
                height : 180,
                collapsible : false,
                minimizable : false,
                maximizable : true,
                href : '${base}/business/monitor/addFurnaceBatchInfo',
                onClose : function() {
                    refreshDg();
                }
            });
        } else {
            showMsg("提示", "请先选择要修改的批次信息！");
        }
    }

    function refreshDg(){
        $("#sampleCodeDg").datagrid("reload");
    }

</script>