<!DOCTYPE html>
<html>
<head>
    <title>设备实时信息</title>
    <base href="${base}/">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
    <meta http-equiv="description" content="this is my page">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <#include "/include/common.html"/>
</head>
<body>
<div id="layoutDiv" class="easyui-layout" style="height:100%">
    <div id="tb">
        <label for="beginTime">开始时间：</label>
        <input class="easyui-datebox" id="beginTime" style="width:120px">
        <label for="endTime">结束时间：</label>
        <input class="easyui-datebox" id="endTime" style="width:120px">
        <!--从数据库里离增加所有设备选项 by yangff -->
        <label for="machinecode">设备名称：</label>
        <input id="machinecode" class="easyui-combobox" style="width:140px;"
               data-options="valueField:'id',textField:'name',panelHeight:'auto',url:'${base}/business/tool/getComboboxOpt/DEVICE_INFO'" />
        <span style="margin-left:0%;"/>
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search"  onclick="qryBroadSpec()">查询</a>
    </div>
    <div data-options="region:'center',title:'设备实时信息',noheader:false;">
        <table id="deviceBroadDg"></table>
    </div>
</div>

</body>
</html>
<script type="text/javascript">
    var deviceBroadPri = "${deviceBroadPri}";
    $deviceBroadDg = $("#deviceBroadDg");

    $(function () {
        var startTime = getDay(-10);
        var endTime = getDay(0);
        var paramO = new Object();
        paramO.search_beginTime = startTime;
        paramO.search_endTime = endTime;
        paramO.search_deviceBroadPri = deviceBroadPri;
        $deviceBroadDg.datagrid({
            url: '${base}/business/monitor/deviceBroadListView',
            fitColumns: true,
            animate: true,
            border: true,
            height: $(this).height() - 5,
            width: $(this).width() - 5,
            idField: 'broadRecId',
            singleSelect: true,
            rownumbers: true,
            pagination: true,
            pagenumber: true,
            pageSize: 15,
            pageList: [15, 30, 45],
            queryParams:paramO,
            columns: [
                [
//                    {field: 'broadRecId', title: '实时信息ID', align: 'center', width: 30},
                    {field: 'broadDec', title: '实时信息描述', align: 'left', width: 60},
                    {field: 'machinName', title: '设备名称', align: 'center', width: 20},
                    {field: 'flowName', title: '流程名称', align: 'center', width: 20},
                    {field: 'broadTime', title: '时间', align: 'center', width: 30}
                ]
            ] ,
            toolbar: '#tb'
        });
    });
    function getDay(day){
        var today = new Date();
        var targetday_milliseconds=today.getTime() + 1000*60*60*24*day;
        today.setTime(targetday_milliseconds); //注意，这行是关键代码
        var tYear = today.getFullYear();
        var tMonth = today.getMonth();
        var tDate = today.getDate();
        tMonth = doHandleMonth(tMonth + 1);
        tDate = doHandleMonth(tDate);
        return tYear+"-"+tMonth+"-"+tDate;
    }
    function doHandleMonth(month){
        var m = month;
        if(month.toString().length == 1){
            m = "0" + month;
        }
        return m;
    }
    function qryBroadSpec() {
        var paramO = new Object();
        var beginTime = $("#beginTime").datebox("getValue");
        var endTime = $("#endTime").datebox("getValue");
        var machineCode = $("#machinecode").combobox("getValue")
        if (beginTime != null && beginTime != "" && beginTime.length > 0) {
            paramO.search_beginTime = beginTime;
        }
        if (endTime != null && endTime != "" && endTime.length > 0) {
            paramO.search_endTime = endTime;
        }
        if (machineCode != null && machineCode != "" && machineCode.length > 0) {
            paramO.search_machineCode = machineCode;
        }
        paramO.search_deviceBroadPri = deviceBroadPri;
        $deviceBroadDg.datagrid("load", paramO);
    }

</script>