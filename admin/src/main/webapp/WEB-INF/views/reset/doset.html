<script type="text/javascript" charset="UTF-8" src="${base}/styles/easyui/jquery.min.js"></script>
<link id="easyuiTheme" rel="stylesheet" type="text/css" href="${base}/styles/easyui/themes/default/easyui.css">
<link rel="stylesheet" type="text/css" href="${base}/styles/easyui/themes/icon.css">
<link rel="stylesheet" type="text/css" href="${base}/styles/easyui/demo/demo.css">
<script type="text/javascript" src="${base}/styles/easyui/jquery.easyui.min.js"></script>
<script type="text/javascript" src="${base}/styles/easyui/locale/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="${base}/styles/easyui/easyloader.js"></script>
<script type="text/javascript" src="${base}/styles/js/common/common.js"></script>
<script type="text/javascript" src="${base}/styles/js/ruleSelf.js"></script>

<style type="text/css">
    body {
        text-align: center
    }
</style>
    <div id="p" class="easyui-window" title="密码重置" data-options="modal:true,minimizable:false,maximizable:false,closable:false,shadow:true"
         style="width: 280px;height:230px;padding: 10px;margin: 0 auto;vertical-align: middle;">

            <form id="ff" method="post" commandName="user">
                <table cellpadding="5">
                    <input type="hidden" name="id"  id="id" value="${(user.id)!}">
                    <input type="hidden" name="roles"  id="roles" value="${(user.roles)!}">
                    <input type="hidden" name="email"  id="email" value="${(user.email)!}">
                    <tr>
                        <td>账号:</td>
                        <td><input class="easyui-textbox"  name="username" id="username" readonly="true" value="${(user.username)!}"/></td>
                    </tr>
                    <tr>
                        <td>密码:</td>
                        <td><input class="easyui-textbox" type="password" name="plainPassword" id="plainPassword" data-options="required:true,validType:'length[6,10]'"/></td>
                    </tr>
                    <tr>
                        <td>确认:</td>
                        <td><input class="easyui-textbox" type="password" name="plainPasswordA" id="plainPasswordA"
                                   data-options='required:true,validType:"equals[\"#plainPassword\"]"' /></td>
                    </tr>
                </table>
            <div style="text-align:center;padding:5px">
                <a href="javascript:void(0)" class="easyui-linkbutton" id="go" onclick="submitForm()">提交</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" id="res" onclick="reset()">重置</a>
            </div>
            </form>

            <div style="text-align:center;margin:5px"><span id="show"></span></div>

    </div>
<script type="text/javascript">

    jQuery(document).ready(function () {
        if("${(result)!}"=="false")
        {
            showMsg("提示", "${(msg)!}");
            setInterval("refer()",1000); //启动1秒定时
        }
    });


    var t=6;//设定跳转的时间
    function refer(){
        if(t==0){
            window.location.href="${base}/"; //#设定跳转的链接地址
            //window.close();
        }
        $('#show').html("<font color='red'>提示：<b>"+t+"&nbsp;&nbsp;</b>秒后跳转到登陆页面</font>"); // 显示倒计时
        t--; // 计数器递减
    }


    $('#ff').find('input').on('keyup', function (event) {
        if (event.keyCode == '13') {
            submitForm();
        }
    });

    function submitForm() {
        if (!$("#ff").form('validate'))  return false;
        $('#go').linkbutton({disabled: true});
        save();
    }

    function save()
    {
        var params = $("#ff").serialize();
        if (! $("#ff").form('validate'))  return false;
        $.post("${base}/reset/updatePwd/"+$('#id').val(),params, function (rsp) {
            if (rsp.successful) {
                $('#go').linkbutton({disabled: true});
                $('#res').linkbutton({disabled: true});
                showMsg("提示", "更新成功!");
            } else {
                showMsg("提示", "更新失败!");
            }
            setInterval("refer()",1000); //启动1秒定时
        }).error(function () {
            showMsg("提示", "更新失败,请重新登陆!");
        });

    }

</script>