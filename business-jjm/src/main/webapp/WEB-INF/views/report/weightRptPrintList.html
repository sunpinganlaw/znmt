<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <base href="${base}/">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
    <meta http-equiv="description" content="this is my page">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">

    <#include "/include/common.html"/>
    <title>打印汽车过卡单</title>
    <style type="text/css">
        body{ background-color:#fff; color:#000; font-size:0.9em; width:1000px; margin:0 auto;}
        h1{ font-size:2em; text-align:center; line-height:2em;}
        table.table01{border-left:1px solid #000;border-top:1px solid #000;border-bottom:1px solid #000;}
        table.table01 td{ border-right:1px solid #000;border-bottom:1px solid #000; padding:5px;}

        table.table02{ border-left:1px solid #000;}
        table.table02 td{ border-right:1px solid #000;border-bottom:1px solid #000; padding:5px;}

        .styip01 input{ margin-right:12px;}
        input[type=checkbox]{ vertical-align:middle;}
        .stymr01{ margin-right:100px;}
        .stymr02{ margin-right:40px;}
    </style>
</head>

<body>
<!--startprint-->
<h1>福建将军帽码头</h1>
<h1 style="font-size:17px">散货车辆过卡报表</h1>

<div style=" width: 98%">

    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span id="DtmPrnt"  style="font-size:20px">&nbsp;</span>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span id="totalCarCnt" style="font-size:20px">&nbsp;</span>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span id="totalNet"  style="font-size:20px">&nbsp;</span>
</div>
<div style=" width: 98%">
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span id="beginDate"  style="font-size:20px">&nbsp;</span>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span id="to"  style="font-size:20px">&nbsp;</span>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span id="endDate" style="font-size:20px">&nbsp;</span>
</div>
<div style=" width: 10%">&nbsp;</div>

<table id="printTable" width="98%" border="0" cellspacing="0" cellpadding="0" class="table01">
    <tr>
        <td style="text-align:center;font-size:1.5em;" width="4%">序号</td>
        <td style="text-align:center;font-size:1.5em;" width="10%">车号</td>
        <td style="text-align:center;font-size:1.5em;" width="7%">毛重</td>
        <td style="text-align:center;font-size:1.5em;" width="7%">皮重</td>
        <td style="text-align:center;font-size:1.5em;" width="7%">净重</td>
        <td style="text-align:center;font-size:1.5em;" width="10%">船名</td>
        <td style="text-align:center;font-size:1.5em;" width="13%">进港时间</td>
        <td style="text-align:center;font-size:1.5em;" width="13%">出港时间</td>
        <td style="text-align:center;font-size:1.5em;" width="17%">发货单位</td>
        <td style="text-align:center;font-size:1.5em;" width="17%">收货单位</td>

    </tr>
</table>

<div style=" width: 10%">&nbsp;</div>


<div>&nbsp;</div>
<div style="text-align: right; width: 90%">
    <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-print" onclick="printJLD();">打印</a>
</div>

</body>
</html>

<script type="text/javascript">
    $(function(){
        var totalCarCnt = 0;
        var totalMz = 0;
        var totalPz = 0;
        var totalNet = 0.00;
        var badCars=0;

        var paramO =  new Object();
        var beginDate ="${beginTime}";
        var endDate =  "${endTime}";
        var carIdQry = "${carId}";
        var shipId = "${shipId}";
        var tickNo ="${tickNo}";
        var venNo= "${venNo}";
        var customerNo="${customerNo}";
        var dateType="${dateType}";


        if(dateType==1)
        {
            if (beginDate != null && beginDate != "" && beginDate.length > 0) {
                paramO.search_beginDate = beginDate;
            }
            if (endDate != null && endDate != "" && endDate.length > 0) {
                paramO.search_endDate = endDate;
            }
        }
        if(dateType==2)
        {
            if (beginDate != null && beginDate != "" && beginDate.length > 0) {
                paramO.search_beginLeaveDate = beginDate;
            }
            if (endDate != null && endDate != "" && endDate.length > 0) {
                paramO.search_endLeaveDate = endDate;
            }
        }

        if (carIdQry != null && carIdQry != "" && carIdQry.length > 0) {
            paramO.search_carId = '%'+carIdQry+'%';
        }
        if (shipId != null && shipId != "" && shipId.length > 0) {
            paramO.search_shipId = shipId;
        }
        if (tickNo != null && tickNo != "" && tickNo.length > 0) {
            paramO.search_tickNo = '%'+tickNo+'%';
        }
        if (venNo != null && venNo != "" && venNo.length > 0) {
            paramO.search_venNo = venNo;
        }
        if (customerNo != null && customerNo != "" && customerNo.length > 0) {
            paramO.search_customerNo = customerNo;
        }

        paramO.search_leaveFlag= 'Y';
        paramO.search_cfmFlag= 'Y';
        paramO.search_order = 'asc';
        paramO.search_sort = 'czDtm';
        $.post("${base}/business/monitor/carTransRecordListRpt", paramO, function(rsp) {
            var arr = rsp.rows;

            var table1 = $('#printTable');
            for (var i=0; i<arr.length; i++) {
                var row = $("<tr></tr>");
                var td = $("<td style='text-align:center;font-size:1.3em;'>"+
                    (i+1)+"</td><td style='text-align:center;font-size:1.3em;'>"+
                    (arr[i].carId==null?"&nbsp;":arr[i].carId)+"</td><td style='text-align:center;font-size:1.3em;'>"+
                    (arr[i].mzQty==null?"&nbsp;":arr[i].mzQty)+"</td><td style='text-align:center;font-size:1.3em;'>"+
                    (arr[i].pzQty==null?"&nbsp;":arr[i].pzQty)+"</td><td style='text-align:center;font-size:1.3em;'>"+
                    (arr[i].netQty==null?"&nbsp;":arr[i].netQty)+"</td><td style='text-align:center;font-size:1.3em;'>"+
                    (arr[i].shipName==null?"&nbsp;":arr[i].shipName)+"</td><td style='text-align:center;font-size:1.3em;'>"+
                    (arr[i].recordDtm==null?"&nbsp;":arr[i].recordDtm)+"</td><td style='text-align:center;font-size:1.3em;'>"+
                    (arr[i].czDtm==null?"&nbsp;":arr[i].czDtm)+"</td><td style='text-align:center;font-size:1.3em;'>"+
                    (arr[i].venName==null?"&nbsp;":arr[i].venName)+"</td><td style='text-align:center;font-size:1.3em;'>"+
                    (arr[i].customerName==null?"&nbsp;":arr[i].customerName)+"</td>");
                row.append(td);
                table1.append(row);

                totalNet = totalNet + (parseFloat(arr[i].netQty==null?"0":arr[i].netQty));
                var tmp= parseFloat(arr[i].netQty==null?"0":arr[i].netQty);
                if(tmp<5)
                {
                    badCars=badCars+1;
                }

            }

           var totalNetStr= totalNet.toFixed(2);
            document.getElementById("totalCarCnt").innerText='总车数：'+(arr.length-badCars);
            document.getElementById("totalNet").innerText='总吨数：'+  totalNetStr;

            document.getElementById("beginDate").innerText='统计时间：'+beginDate;
            document.getElementById("to").innerText='到'
            document.getElementById("endDate").innerText=endDate;
            //从服务器取打印时间
            $.post("${base}/business/tool/getCurrentTime", function (rsp) {
                if (rsp) {
                    document.getElementById("DtmPrnt").innerText = '打印时间：'+ new Date(parseInt(parseInt(rsp)) * 1000).toLocaleString();
                } else {
                    showMsg("提示", "获取服务器当前时间失败!");
                    return false;
                }
            });
        });
    });

    function printJLD() {
        var bdhtml = window.document.body.innerHTML;
        var sprnstr = "<!--startprint-->";
        var eprnstr = "<!--endprint-->";
        var prnhtml = bdhtml.substr(bdhtml.indexOf(sprnstr)+15);
        prnhtml = prnhtml.substring(0,prnhtml.indexOf(eprnstr));
        window.document.body.innerHTML=prnhtml;
        window.print();
    }
</script>